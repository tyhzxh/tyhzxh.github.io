<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>HTTP协议详解：从基础到高级应用 | tyhzxh的个人博客</title>
<meta name="keywords" content="HTTP, 网络协议, Web开发, 计算机网络, 前端, 后端">
<meta name="description" content="深入解析HTTP协议的工作原理、请求响应机制、状态码、缓存策略、安全机制以及HTTP/2和HTTP/3的新特性，涵盖Web开发中的实际应用">
<meta name="author" content="tyhzxh">
<link rel="canonical" href="https://tyhzxh.github.io/posts/http-protocol-guide/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8ee78296343cf29844826f6d943ca1b6638fc5059dcdf673ace996a7617f1b69.css" integrity="sha256-jueCljQ88phEgm9tlDyhtmOPxQWdzfZzrOmWp2F/G2k=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://tyhzxh.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://tyhzxh.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://tyhzxh.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://tyhzxh.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://tyhzxh.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://tyhzxh.github.io/posts/http-protocol-guide/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<style>
/* 归档页面摘要样式 */
.archive-summary {
  margin-bottom: 2rem;
  padding: 1rem;
  background: var(--theme);
  border-radius: 8px;
  border: 1px solid var(--border);
  text-align: center;
  color: var(--secondary);
  font-size: 0.9rem;
}

/* 分页导航样式 */
.pagination {
  display: flex !important;
  justify-content: center;
  align-items: center;
  gap: 1rem;
  margin: 3rem 0;
  padding: 2rem 0;
  border-top: 1px solid var(--border);
}

/* 覆盖主题默认样式 */
.pagination a.pagination-prev,
.pagination a.pagination-next {
  padding: 0.75rem 1.5rem !important;
  background: var(--entry) !important;
  border: 1px solid var(--border) !important;
  border-radius: 6px !important;
  text-decoration: none !important;
  color: var(--primary) !important;
  font-weight: 500 !important;
  transition: all 0.3s ease !important;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05) !important;
  font-size: 14px !important;
  line-height: normal !important;
}

.pagination a.pagination-prev:hover,
.pagination a.pagination-next:hover {
  background: var(--hljs-bg) !important;
  color: var(--primary) !important;
  transform: translateY(-2px) !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
  border-color: var(--tertiary) !important;
}

.pagination-numbers {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

.pagination a.pagination-number,
.pagination-current {
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  width: 2.5rem !important;
  height: 2.5rem !important;
  border-radius: 50% !important;
  text-decoration: none !important;
  font-weight: 500 !important;
  transition: all 0.3s ease !important;
  font-size: 14px !important;
  line-height: normal !important;
  padding: 0 !important;
}

.pagination a.pagination-number {
  background: var(--entry) !important;
  border: 1px solid var(--border) !important;
  color: var(--primary) !important;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05) !important;
}

.pagination a.pagination-number:hover {
  background: var(--hljs-bg) !important;
  color: var(--primary) !important;
  transform: scale(1.1) !important;
  border-color: var(--tertiary) !important;
}

.pagination-current {
  background: var(--tertiary) !important;
  color: var(--primary) !important;
  border: 1px solid var(--tertiary) !important;
  font-weight: 600 !important;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
}

/* 响应式设计 */
@media (max-width: 768px) {
  .pagination {
    flex-direction: column;
    gap: 1rem;
  }
  
  .pagination-prev,
  .pagination-next {
    width: 100%;
    text-align: center;
  }
  
  .pagination-numbers {
    order: -1;
  }
  
  .archive-summary {
    font-size: 0.8rem;
    padding: 0.75rem;
  }
}

/* 暗色主题适配 */
[data-theme="dark"] .archive-summary {
  background: var(--entry);
}

[data-theme="dark"] .pagination-prev,
[data-theme="dark"] .pagination-next,
[data-theme="dark"] .pagination-number {
  background: var(--entry);
  border-color: var(--border);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

[data-theme="dark"] .pagination-prev:hover,
[data-theme="dark"] .pagination-next:hover,
[data-theme="dark"] .pagination-number:hover {
  background: var(--hljs-bg);
  border-color: var(--tertiary);
}

[data-theme="dark"] .pagination-current {
  background: var(--tertiary);
  border-color: var(--tertiary);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}
</style><meta property="og:url" content="https://tyhzxh.github.io/posts/http-protocol-guide/">
  <meta property="og:site_name" content="tyhzxh的个人博客">
  <meta property="og:title" content="HTTP协议详解：从基础到高级应用">
  <meta property="og:description" content="深入解析HTTP协议的工作原理、请求响应机制、状态码、缓存策略、安全机制以及HTTP/2和HTTP/3的新特性，涵盖Web开发中的实际应用">
  <meta property="og:locale" content="zh-cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-28T10:15:00+08:00">
    <meta property="article:modified_time" content="2025-08-06T08:51:21+08:00">
    <meta property="article:tag" content="HTTP">
    <meta property="article:tag" content="网络协议">
    <meta property="article:tag" content="Web开发">
    <meta property="article:tag" content="计算机网络">
    <meta property="article:tag" content="前端">
    <meta property="article:tag" content="后端">
    <meta property="og:image" content="https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=800&amp;h=400&amp;fit=crop">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=800&amp;h=400&amp;fit=crop">
<meta name="twitter:title" content="HTTP协议详解：从基础到高级应用">
<meta name="twitter:description" content="深入解析HTTP协议的工作原理、请求响应机制、状态码、缓存策略、安全机制以及HTTP/2和HTTP/3的新特性，涵盖Web开发中的实际应用">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://tyhzxh.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "HTTP协议详解：从基础到高级应用",
      "item": "https://tyhzxh.github.io/posts/http-protocol-guide/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "HTTP协议详解：从基础到高级应用",
  "name": "HTTP协议详解：从基础到高级应用",
  "description": "深入解析HTTP协议的工作原理、请求响应机制、状态码、缓存策略、安全机制以及HTTP/2和HTTP/3的新特性，涵盖Web开发中的实际应用",
  "keywords": [
    "HTTP", "网络协议", "Web开发", "计算机网络", "前端", "后端"
  ],
  "articleBody": "HTTP协议概述 **HTTP（HyperText Transfer Protocol）**是互联网上应用最广泛的网络协议之一，是Web的基础。它定义了客户端和服务器之间如何进行通信，是一个基于请求-响应模式的、无状态的应用层协议。\nHTTP的核心特点 特点 描述 影响 无状态 每个请求都是独立的 需要额外机制保持状态 无连接 请求完成后断开连接 HTTP/1.1引入持久连接 简单快速 协议简单，处理速度快 易于实现和调试 灵活 支持多种数据类型 可传输任意类型数据 HTTP协议版本演进 HTTP/1.0 vs HTTP/1.1 vs HTTP/2 vs HTTP/3 # HTTP版本特性对比 http_versions = { \"HTTP/1.0\": { \"发布年份\": 1996, \"主要特性\": [ \"基本的请求-响应机制\", \"支持GET、POST、HEAD方法\", \"每个请求建立新连接\" ], \"缺点\": [\"连接开销大\", \"无法复用连接\"] }, \"HTTP/1.1\": { \"发布年份\": 1997, \"主要特性\": [ \"持久连接（Keep-Alive）\", \"管道化（Pipelining）\", \"分块传输编码\", \"Host头字段\", \"更多HTTP方法\" ], \"改进\": [\"减少连接开销\", \"支持虚拟主机\"] }, \"HTTP/2\": { \"发布年份\": 2015, \"主要特性\": [ \"二进制分帧\", \"多路复用\", \"头部压缩（HPACK）\", \"服务器推送\", \"流优先级\" ], \"性能提升\": [\"解决队头阻塞\", \"减少延迟\"] }, \"HTTP/3\": { \"发布年份\": 2022, \"主要特性\": [ \"基于QUIC协议\", \"UDP传输\", \"内置加密\", \"连接迁移\", \"0-RTT连接建立\" ], \"优势\": [\"更快的连接建立\", \"更好的移动网络支持\"] } } for version, details in http_versions.items(): print(f\"\\n{version} ({details['发布年份']}年):\") for feature in details.get('主要特性', []): print(f\" • {feature}\") HTTP请求和响应结构 HTTP请求结构 GET /api/users/123 HTTP/1.1 Host: api.example.com User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 Accept: application/json Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... Content-Type: application/json Content-Length: 85 { \"name\": \"张三\", \"email\": \"zhangsan@example.com\" } 请求结构解析 class HTTPRequest: \"\"\"HTTP请求结构解析\"\"\" def __init__(self, raw_request): self.raw_request = raw_request self.parse_request() def parse_request(self): \"\"\"解析HTTP请求\"\"\" lines = self.raw_request.strip().split('\\n') # 解析请求行 request_line = lines[0] self.method, self.path, self.version = request_line.split(' ') # 解析请求头 self.headers = {} body_start = 1 for i, line in enumerate(lines[1:], 1): if line.strip() == '': body_start = i + 1 break if ':' in line: key, value = line.split(':', 1) self.headers[key.strip()] = value.strip() # 解析请求体 if body_start \u003c len(lines): self.body = '\\n'.join(lines[body_start:]) else: self.body = '' def get_info(self): \"\"\"获取请求信息\"\"\" return { \"method\": self.method, \"path\": self.path, \"version\": self.version, \"headers\": self.headers, \"body\": self.body } # 示例使用 sample_request = \"\"\"GET /api/users HTTP/1.1 Host: api.example.com User-Agent: Mozilla/5.0 Accept: application/json \"\"\" request = HTTPRequest(sample_request) print(\"请求信息:\", request.get_info()) HTTP响应结构 HTTP/1.1 200 OK Date: Mon, 27 Feb 2024 10:15:30 GMT Server: nginx/1.18.0 Content-Type: application/json; charset=utf-8 Content-Length: 156 Cache-Control: max-age=3600 ETag: \"33a64df551425fcc55e4d42a148795d9f25f89d4\" Access-Control-Allow-Origin: * { \"id\": 123, \"name\": \"张三\", \"email\": \"zhangsan@example.com\", \"created_at\": \"2024-02-27T10:15:30Z\", \"status\": \"active\" } 响应结构解析 class HTTPResponse: \"\"\"HTTP响应结构解析\"\"\" def __init__(self, raw_response): self.raw_response = raw_response self.parse_response() def parse_response(self): \"\"\"解析HTTP响应\"\"\" lines = self.raw_response.strip().split('\\n') # 解析状态行 status_line = lines[0] parts = status_line.split(' ', 2) self.version = parts[0] self.status_code = int(parts[1]) self.reason_phrase = parts[2] if len(parts) \u003e 2 else '' # 解析响应头 self.headers = {} body_start = 1 for i, line in enumerate(lines[1:], 1): if line.strip() == '': body_start = i + 1 break if ':' in line: key, value = line.split(':', 1) self.headers[key.strip()] = value.strip() # 解析响应体 if body_start \u003c len(lines): self.body = '\\n'.join(lines[body_start:]) else: self.body = '' def is_success(self): \"\"\"判断是否成功响应\"\"\" return 200 \u003c= self.status_code \u003c 300 def get_info(self): \"\"\"获取响应信息\"\"\" return { \"version\": self.version, \"status_code\": self.status_code, \"reason_phrase\": self.reason_phrase, \"headers\": self.headers, \"body\": self.body, \"is_success\": self.is_success() } HTTP方法详解 常用HTTP方法 class HTTPMethods: \"\"\"HTTP方法详解和示例\"\"\" @staticmethod def get_method_info(): \"\"\"获取HTTP方法信息\"\"\" methods = { \"GET\": { \"用途\": \"获取资源\", \"特点\": [\"安全\", \"幂等\", \"可缓存\"], \"示例\": \"GET /api/users/123\" }, \"POST\": { \"用途\": \"创建资源或提交数据\", \"特点\": [\"不安全\", \"非幂等\", \"不可缓存\"], \"示例\": \"POST /api/users\" }, \"PUT\": { \"用途\": \"更新或创建资源\", \"特点\": [\"不安全\", \"幂等\", \"不可缓存\"], \"示例\": \"PUT /api/users/123\" }, \"DELETE\": { \"用途\": \"删除资源\", \"特点\": [\"不安全\", \"幂等\", \"不可缓存\"], \"示例\": \"DELETE /api/users/123\" }, \"PATCH\": { \"用途\": \"部分更新资源\", \"特点\": [\"不安全\", \"非幂等\", \"不可缓存\"], \"示例\": \"PATCH /api/users/123\" }, \"HEAD\": { \"用途\": \"获取资源头信息\", \"特点\": [\"安全\", \"幂等\", \"可缓存\"], \"示例\": \"HEAD /api/users/123\" }, \"OPTIONS\": { \"用途\": \"获取服务器支持的方法\", \"特点\": [\"安全\", \"幂等\", \"不可缓存\"], \"示例\": \"OPTIONS /api/users\" } } return methods # RESTful API设计示例 class RESTfulAPI: \"\"\"RESTful API设计示例\"\"\" def __init__(self): self.users = {} self.next_id = 1 def handle_request(self, method, path, data=None): \"\"\"处理HTTP请求\"\"\" if path.startswith('/api/users'): if method == 'GET': if path == '/api/users': return self.get_users() else: user_id = self.extract_id(path) return self.get_user(user_id) elif method == 'POST' and path == '/api/users': return self.create_user(data) elif method == 'PUT': user_id = self.extract_id(path) return self.update_user(user_id, data) elif method == 'DELETE': user_id = self.extract_id(path) return self.delete_user(user_id) elif method == 'PATCH': user_id = self.extract_id(path) return self.patch_user(user_id, data) return {\"error\": \"Not Found\", \"status\": 404} def extract_id(self, path): \"\"\"从路径中提取ID\"\"\" parts = path.split('/') return int(parts[-1]) if parts[-1].isdigit() else None def get_users(self): \"\"\"获取所有用户\"\"\" return {\"users\": list(self.users.values()), \"status\": 200} def get_user(self, user_id): \"\"\"获取单个用户\"\"\" if user_id in self.users: return {\"user\": self.users[user_id], \"status\": 200} return {\"error\": \"User not found\", \"status\": 404} def create_user(self, data): \"\"\"创建用户\"\"\" user_id = self.next_id self.next_id += 1 user = { \"id\": user_id, \"name\": data.get(\"name\"), \"email\": data.get(\"email\"), \"created_at\": \"2024-02-27T10:15:30Z\" } self.users[user_id] = user return {\"user\": user, \"status\": 201} def update_user(self, user_id, data): \"\"\"更新用户（完整替换）\"\"\" user = { \"id\": user_id, \"name\": data.get(\"name\"), \"email\": data.get(\"email\"), \"updated_at\": \"2024-02-27T10:15:30Z\" } self.users[user_id] = user return {\"user\": user, \"status\": 200} def patch_user(self, user_id, data): \"\"\"部分更新用户\"\"\" if user_id not in self.users: return {\"error\": \"User not found\", \"status\": 404} user = self.users[user_id].copy() user.update(data) user[\"updated_at\"] = \"2024-02-27T10:15:30Z\" self.users[user_id] = user return {\"user\": user, \"status\": 200} def delete_user(self, user_id): \"\"\"删除用户\"\"\" if user_id in self.users: del self.users[user_id] return {\"message\": \"User deleted\", \"status\": 204} return {\"error\": \"User not found\", \"status\": 404} # 示例使用 api = RESTfulAPI() # 创建用户 result = api.handle_request('POST', '/api/users', { \"name\": \"张三\", \"email\": \"zhangsan@example.com\" }) print(\"创建用户:\", result) # 获取用户 result = api.handle_request('GET', '/api/users/1') print(\"获取用户:\", result) # 更新用户 result = api.handle_request('PATCH', '/api/users/1', { \"name\": \"张三丰\" }) print(\"更新用户:\", result) HTTP状态码详解 状态码分类和含义 class HTTPStatusCodes: \"\"\"HTTP状态码详解\"\"\" def __init__(self): self.status_codes = { # 1xx 信息性状态码 100: {\"name\": \"Continue\", \"description\": \"继续请求\"}, 101: {\"name\": \"Switching Protocols\", \"description\": \"切换协议\"}, 102: {\"name\": \"Processing\", \"description\": \"处理中\"}, # 2xx 成功状态码 200: {\"name\": \"OK\", \"description\": \"请求成功\"}, 201: {\"name\": \"Created\", \"description\": \"资源已创建\"}, 202: {\"name\": \"Accepted\", \"description\": \"请求已接受\"}, 204: {\"name\": \"No Content\", \"description\": \"无内容\"}, 206: {\"name\": \"Partial Content\", \"description\": \"部分内容\"}, # 3xx 重定向状态码 301: {\"name\": \"Moved Permanently\", \"description\": \"永久重定向\"}, 302: {\"name\": \"Found\", \"description\": \"临时重定向\"}, 304: {\"name\": \"Not Modified\", \"description\": \"未修改\"}, 307: {\"name\": \"Temporary Redirect\", \"description\": \"临时重定向\"}, 308: {\"name\": \"Permanent Redirect\", \"description\": \"永久重定向\"}, # 4xx 客户端错误状态码 400: {\"name\": \"Bad Request\", \"description\": \"请求错误\"}, 401: {\"name\": \"Unauthorized\", \"description\": \"未授权\"}, 403: {\"name\": \"Forbidden\", \"description\": \"禁止访问\"}, 404: {\"name\": \"Not Found\", \"description\": \"资源未找到\"}, 405: {\"name\": \"Method Not Allowed\", \"description\": \"方法不允许\"}, 409: {\"name\": \"Conflict\", \"description\": \"冲突\"}, 422: {\"name\": \"Unprocessable Entity\", \"description\": \"无法处理的实体\"}, 429: {\"name\": \"Too Many Requests\", \"description\": \"请求过多\"}, # 5xx 服务器错误状态码 500: {\"name\": \"Internal Server Error\", \"description\": \"服务器内部错误\"}, 501: {\"name\": \"Not Implemented\", \"description\": \"未实现\"}, 502: {\"name\": \"Bad Gateway\", \"description\": \"网关错误\"}, 503: {\"name\": \"Service Unavailable\", \"description\": \"服务不可用\"}, 504: {\"name\": \"Gateway Timeout\", \"description\": \"网关超时\"}, } def get_status_info(self, code): \"\"\"获取状态码信息\"\"\" if code in self.status_codes: return self.status_codes[code] return {\"name\": \"Unknown\", \"description\": \"未知状态码\"} def get_category(self, code): \"\"\"获取状态码类别\"\"\" if 100 \u003c= code \u003c 200: return \"信息性响应\" elif 200 \u003c= code \u003c 300: return \"成功响应\" elif 300 \u003c= code \u003c 400: return \"重定向\" elif 400 \u003c= code \u003c 500: return \"客户端错误\" elif 500 \u003c= code \u003c 600: return \"服务器错误\" else: return \"未知类别\" def is_error(self, code): \"\"\"判断是否为错误状态码\"\"\" return code \u003e= 400 # 状态码使用示例 def handle_api_response(status_code, data=None): \"\"\"处理API响应\"\"\" status_handler = HTTPStatusCodes() info = status_handler.get_status_info(status_code) category = status_handler.get_category(status_code) response = { \"status_code\": status_code, \"status_name\": info[\"name\"], \"description\": info[\"description\"], \"category\": category, \"is_error\": status_handler.is_error(status_code) } if data: response[\"data\"] = data return response # 示例使用 print(\"成功响应:\", handle_api_response(200, {\"message\": \"操作成功\"})) print(\"客户端错误:\", handle_api_response(404)) print(\"服务器错误:\", handle_api_response(500)) HTTP头字段详解 常用请求头 class HTTPHeaders: \"\"\"HTTP头字段详解\"\"\" def __init__(self): self.request_headers = { \"Accept\": { \"用途\": \"指定客户端能够接收的内容类型\", \"示例\": \"Accept: application/json, text/html\", \"重要性\": \"高\" }, \"Accept-Encoding\": { \"用途\": \"指定客户端支持的编码格式\", \"示例\": \"Accept-Encoding: gzip, deflate, br\", \"重要性\": \"中\" }, \"Accept-Language\": { \"用途\": \"指定客户端偏好的语言\", \"示例\": \"Accept-Language: zh-CN,zh;q=0.9,en;q=0.8\", \"重要性\": \"中\" }, \"Authorization\": { \"用途\": \"包含认证凭据\", \"示例\": \"Authorization: Bearer eyJhbGciOiJIUzI1NiIs...\", \"重要性\": \"高\" }, \"Cache-Control\": { \"用途\": \"指定缓存机制\", \"示例\": \"Cache-Control: no-cache, max-age=0\", \"重要性\": \"高\" }, \"Content-Type\": { \"用途\": \"指定请求体的媒体类型\", \"示例\": \"Content-Type: application/json; charset=utf-8\", \"重要性\": \"高\" }, \"Cookie\": { \"用途\": \"发送存储的Cookie\", \"示例\": \"Cookie: sessionid=abc123; csrftoken=xyz789\", \"重要性\": \"高\" }, \"Host\": { \"用途\": \"指定服务器的域名和端口\", \"示例\": \"Host: api.example.com:443\", \"重要性\": \"必需\" }, \"Referer\": { \"用途\": \"指定请求来源页面\", \"示例\": \"Referer: https://example.com/page\", \"重要性\": \"中\" }, \"User-Agent\": { \"用途\": \"标识客户端应用程序\", \"示例\": \"User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)\", \"重要性\": \"中\" } } self.response_headers = { \"Access-Control-Allow-Origin\": { \"用途\": \"CORS跨域访问控制\", \"示例\": \"Access-Control-Allow-Origin: *\", \"重要性\": \"高\" }, \"Cache-Control\": { \"用途\": \"指定缓存策略\", \"示例\": \"Cache-Control: public, max-age=3600\", \"重要性\": \"高\" }, \"Content-Encoding\": { \"用途\": \"指定内容编码格式\", \"示例\": \"Content-Encoding: gzip\", \"重要性\": \"中\" }, \"Content-Length\": { \"用途\": \"指定响应体长度\", \"示例\": \"Content-Length: 1024\", \"重要性\": \"高\" }, \"Content-Type\": { \"用途\": \"指定响应体的媒体类型\", \"示例\": \"Content-Type: application/json; charset=utf-8\", \"重要性\": \"高\" }, \"ETag\": { \"用途\": \"资源的唯一标识符\", \"示例\": \"ETag: \\\"33a64df551425fcc55e4d42a148795d9f25f89d4\\\"\", \"重要性\": \"中\" }, \"Expires\": { \"用途\": \"指定资源过期时间\", \"示例\": \"Expires: Wed, 21 Oct 2024 07:28:00 GMT\", \"重要性\": \"中\" }, \"Last-Modified\": { \"用途\": \"资源最后修改时间\", \"示例\": \"Last-Modified: Wed, 21 Oct 2024 07:28:00 GMT\", \"重要性\": \"中\" }, \"Location\": { \"用途\": \"重定向的目标URL\", \"示例\": \"Location: https://example.com/new-page\", \"重要性\": \"高\" }, \"Set-Cookie\": { \"用途\": \"设置Cookie\", \"示例\": \"Set-Cookie: sessionid=abc123; HttpOnly; Secure\", \"重要性\": \"高\" } } # 头字段处理示例 class HeaderProcessor: \"\"\"HTTP头字段处理器\"\"\" def __init__(self): self.headers = {} def add_header(self, name, value): \"\"\"添加头字段\"\"\" self.headers[name] = value def get_content_type(self): \"\"\"获取内容类型\"\"\" content_type = self.headers.get('Content-Type', '') if ';' in content_type: return content_type.split(';')[0].strip() return content_type def get_charset(self): \"\"\"获取字符编码\"\"\" content_type = self.headers.get('Content-Type', '') if 'charset=' in content_type: return content_type.split('charset=')[1].strip() return 'utf-8' def is_json(self): \"\"\"判断是否为JSON格式\"\"\" return self.get_content_type() == 'application/json' def get_cache_control(self): \"\"\"解析Cache-Control头\"\"\" cache_control = self.headers.get('Cache-Control', '') directives = {} for directive in cache_control.split(','): directive = directive.strip() if '=' in directive: key, value = directive.split('=', 1) directives[key.strip()] = value.strip() else: directives[directive] = True return directives def get_authorization_type(self): \"\"\"获取认证类型\"\"\" auth = self.headers.get('Authorization', '') if auth: return auth.split(' ')[0] return None # 示例使用 processor = HeaderProcessor() processor.add_header('Content-Type', 'application/json; charset=utf-8') processor.add_header('Cache-Control', 'public, max-age=3600, must-revalidate') processor.add_header('Authorization', 'Bearer eyJhbGciOiJIUzI1NiIs...') print(\"内容类型:\", processor.get_content_type()) print(\"字符编码:\", processor.get_charset()) print(\"是否JSON:\", processor.is_json()) print(\"缓存控制:\", processor.get_cache_control()) print(\"认证类型:\", processor.get_authorization_type()) HTTP缓存机制 缓存策略详解 import hashlib import time from datetime import datetime, timedelta class HTTPCache: \"\"\"HTTP缓存机制实现\"\"\" def __init__(self): self.cache = {} def generate_etag(self, content): \"\"\"生成ETag\"\"\" return hashlib.md5(content.encode()).hexdigest() def is_fresh(self, cache_entry): \"\"\"检查缓存是否新鲜\"\"\" if 'expires' in cache_entry: return datetime.now() \u003c cache_entry['expires'] if 'max_age' in cache_entry: age = datetime.now() - cache_entry['cached_at'] return age.total_seconds() \u003c cache_entry['max_age'] return False def handle_cache_request(self, url, headers=None): \"\"\"处理缓存请求\"\"\" if headers is None: headers = {} cache_entry = self.cache.get(url) # 检查是否有缓存 if not cache_entry: return {\"cache_status\": \"MISS\", \"should_fetch\": True} # 检查缓存是否新鲜 if not self.is_fresh(cache_entry): return {\"cache_status\": \"STALE\", \"should_fetch\": True} # 检查条件请求 if 'If-None-Match' in headers: if headers['If-None-Match'] == cache_entry.get('etag'): return {\"cache_status\": \"NOT_MODIFIED\", \"should_fetch\": False} if 'If-Modified-Since' in headers: if_modified = datetime.strptime(headers['If-Modified-Since'], '%a, %d %b %Y %H:%M:%S GMT') if cache_entry.get('last_modified') and if_modified \u003e= cache_entry['last_modified']: return {\"cache_status\": \"NOT_MODIFIED\", \"should_fetch\": False} return {\"cache_status\": \"HIT\", \"should_fetch\": False, \"data\": cache_entry['data']} def store_response(self, url, response_data, headers): \"\"\"存储响应到缓存\"\"\" cache_entry = { \"data\": response_data, \"cached_at\": datetime.now(), \"headers\": headers } # 处理ETag if 'ETag' in headers: cache_entry['etag'] = headers['ETag'] # 处理Last-Modified if 'Last-Modified' in headers: cache_entry['last_modified'] = datetime.strptime( headers['Last-Modified'], '%a, %d %b %Y %H:%M:%S GMT' ) # 处理Expires if 'Expires' in headers: cache_entry['expires'] = datetime.strptime( headers['Expires'], '%a, %d %b %Y %H:%M:%S GMT' ) # 处理Cache-Control if 'Cache-Control' in headers: cache_control = self.parse_cache_control(headers['Cache-Control']) if 'max-age' in cache_control: cache_entry['max_age'] = int(cache_control['max-age']) if 'no-cache' in cache_control or 'no-store' in cache_control: return # 不缓存 self.cache[url] = cache_entry def parse_cache_control(self, cache_control_header): \"\"\"解析Cache-Control头\"\"\" directives = {} for directive in cache_control_header.split(','): directive = directive.strip() if '=' in directive: key, value = directive.split('=', 1) directives[key.strip()] = value.strip() else: directives[directive] = True return directives # 缓存策略示例 class CacheStrategy: \"\"\"缓存策略示例\"\"\" @staticmethod def get_cache_headers(resource_type, max_age=3600): \"\"\"根据资源类型获取缓存头\"\"\" strategies = { \"static\": { \"Cache-Control\": f\"public, max-age={max_age * 24 * 365}\", # 1年 \"Expires\": (datetime.now() + timedelta(days=365)).strftime( '%a, %d %b %Y %H:%M:%S GMT' ) }, \"api\": { \"Cache-Control\": f\"private, max-age={max_age}\", # 1小时 \"ETag\": '\"' + hashlib.md5(str(time.time()).encode()).hexdigest() + '\"' }, \"dynamic\": { \"Cache-Control\": \"no-cache, must-revalidate\", \"Pragma\": \"no-cache\" }, \"sensitive\": { \"Cache-Control\": \"no-store, no-cache, must-revalidate\", \"Pragma\": \"no-cache\", \"Expires\": \"0\" } } return strategies.get(resource_type, strategies[\"dynamic\"]) # 示例使用 cache = HTTPCache() # 模拟第一次请求 url = \"https://api.example.com/users\" result = cache.handle_cache_request(url) print(\"第一次请求:\", result) # 存储响应 response_data = {\"users\": [{\"id\": 1, \"name\": \"张三\"}]} response_headers = { \"Cache-Control\": \"public, max-age=3600\", \"ETag\": '\"abc123\"', \"Last-Modified\": \"Mon, 27 Feb 2024 10:15:30 GMT\" } cache.store_response(url, response_data, response_headers) # 模拟第二次请求 result = cache.handle_cache_request(url) print(\"第二次请求:\", result) # 模拟条件请求 conditional_headers = {\"If-None-Match\": '\"abc123\"'} result = cache.handle_cache_request(url, conditional_headers) print(\"条件请求:\", result) HTTP安全机制 HTTPS和安全头 class HTTPSecurity: \"\"\"HTTP安全机制\"\"\" def __init__(self): self.security_headers = { \"Strict-Transport-Security\": { \"用途\": \"强制使用HTTPS\", \"示例\": \"Strict-Transport-Security: max-age=31536000; includeSubDomains\", \"防护\": \"中间人攻击\" }, \"Content-Security-Policy\": { \"用途\": \"防止XSS攻击\", \"示例\": \"Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline'\", \"防护\": \"跨站脚本攻击\" }, \"X-Frame-Options\": { \"用途\": \"防止点击劫持\", \"示例\": \"X-Frame-Options: DENY\", \"防护\": \"点击劫持攻击\" }, \"X-Content-Type-Options\": { \"用途\": \"防止MIME类型嗅探\", \"示例\": \"X-Content-Type-Options: nosniff\", \"防护\": \"MIME嗅探攻击\" }, \"X-XSS-Protection\": { \"用途\": \"启用XSS过滤器\", \"示例\": \"X-XSS-Protection: 1; mode=block\", \"防护\": \"反射型XSS攻击\" }, \"Referrer-Policy\": { \"用途\": \"控制Referer头信息\", \"示例\": \"Referrer-Policy: strict-origin-when-cross-origin\", \"防护\": \"信息泄露\" } } def get_security_headers(self, security_level=\"high\"): \"\"\"获取安全头配置\"\"\" if security_level == \"high\": return { \"Strict-Transport-Security\": \"max-age=31536000; includeSubDomains; preload\", \"Content-Security-Policy\": \"default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'\", \"X-Frame-Options\": \"DENY\", \"X-Content-Type-Options\": \"nosniff\", \"X-XSS-Protection\": \"1; mode=block\", \"Referrer-Policy\": \"strict-origin-when-cross-origin\" } elif security_level == \"medium\": return { \"Strict-Transport-Security\": \"max-age=31536000\", \"Content-Security-Policy\": \"default-src 'self' 'unsafe-inline'\", \"X-Frame-Options\": \"SAMEORIGIN\", \"X-Content-Type-Options\": \"nosniff\" } else: return { \"X-Content-Type-Options\": \"nosniff\" } def validate_request(self, headers, body=None): \"\"\"验证请求安全性\"\"\" issues = [] # 检查Content-Type if body and 'Content-Type' not in headers: issues.append(\"缺少Content-Type头\") # 检查CSRF保护 if headers.get('Content-Type', '').startswith('application/json'): if 'X-Requested-With' not in headers and 'X-CSRF-Token' not in headers: issues.append(\"可能存在CSRF风险\") # 检查认证 if 'Authorization' not in headers and 'Cookie' not in headers: issues.append(\"缺少认证信息\") return { \"is_secure\": len(issues) == 0, \"issues\": issues } # CORS处理 class CORSHandler: \"\"\"CORS跨域资源共享处理\"\"\" def __init__(self, allowed_origins=None, allowed_methods=None, allowed_headers=None): self.allowed_origins = allowed_origins or ['*'] self.allowed_methods = allowed_methods or ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'] self.allowed_headers = allowed_headers or ['Content-Type', 'Authorization', 'X-Requested-With'] def handle_preflight(self, origin, method, headers): \"\"\"处理预检请求\"\"\" response_headers = {} # 检查来源 if self.is_origin_allowed(origin): response_headers['Access-Control-Allow-Origin'] = origin # 检查方法 if method in self.allowed_methods: response_headers['Access-Control-Allow-Methods'] = ', '.join(self.allowed_methods) # 检查头部 if headers: requested_headers = [h.strip() for h in headers.split(',')] allowed = [h for h in requested_headers if h in self.allowed_headers] if allowed: response_headers['Access-Control-Allow-Headers'] = ', '.join(allowed) response_headers['Access-Control-Max-Age'] = '86400' # 24小时 return response_headers def handle_actual_request(self, origin): \"\"\"处理实际请求\"\"\" response_headers = {} if self.is_origin_allowed(origin): response_headers['Access-Control-Allow-Origin'] = origin response_headers['Access-Control-Allow-Credentials'] = 'true' return response_headers def is_origin_allowed(self, origin): \"\"\"检查来源是否被允许\"\"\" return '*' in self.allowed_origins or origin in self.allowed_origins # 示例使用 security = HTTPSecurity() print(\"高安全级别头部:\", security.get_security_headers(\"high\")) # CORS示例 cors = CORSHandler( allowed_origins=['https://example.com', 'https://app.example.com'], allowed_methods=['GET', 'POST', 'PUT', 'DELETE'], allowed_headers=['Content-Type', 'Authorization'] ) preflight_headers = cors.handle_preflight( origin='https://example.com', method='POST', headers='Content-Type, Authorization' ) print(\"预检响应头:\", preflight_headers) HTTP/2 和 HTTP/3 新特性 HTTP/2 特性 class HTTP2Features: \"\"\"HTTP/2 特性演示\"\"\" def __init__(self): self.streams = {} self.next_stream_id = 1 def create_stream(self, method, path, headers=None): \"\"\"创建HTTP/2流\"\"\" stream_id = self.next_stream_id self.next_stream_id += 2 # 客户端流ID为奇数 stream = { \"id\": stream_id, \"method\": method, \"path\": path, \"headers\": headers or {}, \"state\": \"open\", \"priority\": 16, # 默认优先级 \"dependency\": 0 } self.streams[stream_id] = stream return stream_id def set_priority(self, stream_id, priority, dependency=0): \"\"\"设置流优先级\"\"\" if stream_id in self.streams: self.streams[stream_id][\"priority\"] = priority self.streams[stream_id][\"dependency\"] = dependency def server_push(self, parent_stream_id, path, headers=None): \"\"\"服务器推送\"\"\" push_stream_id = self.next_stream_id + 1 self.next_stream_id += 2 push_stream = { \"id\": push_stream_id, \"method\": \"GET\", \"path\": path, \"headers\": headers or {}, \"state\": \"reserved_local\", \"parent\": parent_stream_id, \"pushed\": True } self.streams[push_stream_id] = push_stream return push_stream_id def compress_headers(self, headers): \"\"\"HPACK头部压缩模拟\"\"\" # 简化的头部压缩示例 compressed_size = 0 static_table = { \":method\": {\"GET\": 2, \"POST\": 3}, \":path\": {\"/\": 4}, \":scheme\": {\"https\": 7}, \"content-type\": {\"application/json\": 31} } for name, value in headers.items(): if name in static_table and value in static_table[name]: compressed_size += 1 # 索引引用 else: compressed_size += len(name) + len(value) # 字面量 original_size = sum(len(k) + len(v) for k, v in headers.items()) compression_ratio = compressed_size / original_size if original_size \u003e 0 else 1 return { \"original_size\": original_size, \"compressed_size\": compressed_size, \"compression_ratio\": compression_ratio } # HTTP/3 特性 class HTTP3Features: \"\"\"HTTP/3 特性演示\"\"\" def __init__(self): self.connections = {} self.connection_id = 0 def create_connection(self, server_name): \"\"\"创建QUIC连接\"\"\" self.connection_id += 1 connection = { \"id\": self.connection_id, \"server_name\": server_name, \"state\": \"handshaking\", \"streams\": {}, \"rtt\": 0, \"congestion_window\": 10, \"migration_capable\": True } self.connections[self.connection_id] = connection return self.connection_id def zero_rtt_request(self, connection_id, method, path, early_data=None): \"\"\"0-RTT请求\"\"\" if connection_id not in self.connections: return None connection = self.connections[connection_id] # 模拟0-RTT请求 request = { \"method\": method, \"path\": path, \"early_data\": early_data, \"rtt\": 0, # 0-RTT \"timestamp\": time.time() } return request def connection_migration(self, connection_id, new_address): \"\"\"连接迁移\"\"\" if connection_id not in self.connections: return False connection = self.connections[connection_id] if connection[\"migration_capable\"]: connection[\"address\"] = new_address connection[\"migrated\"] = True return True return False def get_performance_comparison(self): \"\"\"性能对比\"\"\" return { \"HTTP/1.1\": { \"连接建立\": \"3-RTT (TCP + TLS)\", \"多路复用\": \"无\", \"头部压缩\": \"无\", \"服务器推送\": \"无\" }, \"HTTP/2\": { \"连接建立\": \"3-RTT (TCP + TLS)\", \"多路复用\": \"有 (单连接)\", \"头部压缩\": \"HPACK\", \"服务器推送\": \"有\" }, \"HTTP/3\": { \"连接建立\": \"1-RTT (QUIC)\", \"多路复用\": \"有 (无队头阻塞)\", \"头部压缩\": \"QPACK\", \"服务器推送\": \"有\", \"连接迁移\": \"有\", \"0-RTT\": \"有\" } } # 示例使用 http2 = HTTP2Features() # 创建多个流 stream1 = http2.create_stream(\"GET\", \"/api/users\") stream2 = http2.create_stream(\"GET\", \"/api/posts\") stream3 = http2.create_stream(\"GET\", \"/static/app.js\") # 设置优先级 http2.set_priority(stream3, 8) # 静态资源优先级较低 # 服务器推送 push_stream = http2.server_push(stream1, \"/static/style.css\") # 头部压缩 headers = { \":method\": \"GET\", \":path\": \"/api/users\", \":scheme\": \"https\", \"content-type\": \"application/json\" } compression_result = http2.compress_headers(headers) print(\"头部压缩结果:\", compression_result) # HTTP/3示例 http3 = HTTP3Features() conn_id = http3.create_connection(\"api.example.com\") # 0-RTT请求 zero_rtt_req = http3.zero_rtt_request(conn_id, \"GET\", \"/api/users\") print(\"0-RTT请求:\", zero_rtt_req) # 性能对比 comparison = http3.get_performance_comparison() for version, features in comparison.items(): print(f\"\\n{version}:\") for feature, value in features.items(): print(f\" {feature}: {value}\") 实际应用和最佳实践 Web API设计最佳实践 class WebAPIBestPractices: \"\"\"Web API设计最佳实践\"\"\" def __init__(self): self.api_guidelines = { \"URL设计\": [ \"使用名词而非动词\", \"使用复数形式\", \"保持URL简洁\", \"使用连字符分隔单词\" ], \"HTTP方法使用\": [ \"GET: 获取资源\", \"POST: 创建资源\", \"PUT: 完整更新资源\", \"PATCH: 部分更新资源\", \"DELETE: 删除资源\" ], \"状态码使用\": [ \"200: 成功\", \"201: 创建成功\", \"204: 无内容\", \"400: 请求错误\", \"401: 未授权\", \"403: 禁止访问\", \"404: 资源未找到\", \"500: 服务器错误\" ], \"响应格式\": [ \"使用JSON格式\", \"保持响应结构一致\", \"包含适当的元数据\", \"提供错误详情\" ] } def design_api_response(self, data=None, error=None, meta=None): \"\"\"设计API响应格式\"\"\" response = {} if error: response[\"success\"] = False response[\"error\"] = { \"code\": error.get(\"code\", \"UNKNOWN_ERROR\"), \"message\": error.get(\"message\", \"An error occurred\"), \"details\": error.get(\"details\") } else: response[\"success\"] = True response[\"data\"] = data if meta: response[\"meta\"] = meta response[\"timestamp\"] = datetime.now().isoformat() return response def paginate_response(self, items, page=1, per_page=20, total=None): \"\"\"分页响应\"\"\" start = (page - 1) * per_page end = start + per_page paginated_items = items[start:end] if total is None: total = len(items) total_pages = (total + per_page - 1) // per_page return self.design_api_response( data=paginated_items, meta={ \"pagination\": { \"page\": page, \"per_page\": per_page, \"total\": total, \"total_pages\": total_pages, \"has_next\": page \u003c total_pages, \"has_prev\": page \u003e 1 } } ) def validate_request(self, request_data, required_fields=None): \"\"\"请求验证\"\"\" errors = [] if required_fields: for field in required_fields: if field not in request_data: errors.append(f\"缺少必需字段: {field}\") elif not request_data[field]: errors.append(f\"字段不能为空: {field}\") return { \"is_valid\": len(errors) == 0, \"errors\": errors } # 性能优化建议 class HTTPPerformanceOptimization: \"\"\"HTTP性能优化\"\"\" def __init__(self): self.optimization_techniques = { \"缓存策略\": [ \"设置适当的Cache-Control头\", \"使用ETag进行条件请求\", \"实施CDN缓存\", \"使用浏览器缓存\" ], \"压缩技术\": [ \"启用Gzip/Brotli压缩\", \"压缩静态资源\", \"优化图片格式\", \"使用WebP格式\" ], \"连接优化\": [ \"使用HTTP/2或HTTP/3\", \"启用Keep-Alive\", \"减少DNS查询\", \"使用连接池\" ], \"请求优化\": [ \"减少HTTP请求数量\", \"合并CSS和JavaScript文件\", \"使用雪碧图\", \"延迟加载非关键资源\" ] } def analyze_performance(self, response_time, response_size, cache_hit_ratio): \"\"\"性能分析\"\"\" analysis = { \"response_time\": { \"value\": response_time, \"status\": \"good\" if response_time \u003c 200 else \"needs_improvement\" }, \"response_size\": { \"value\": response_size, \"status\": \"good\" if response_size \u003c 1024 * 1024 else \"large\" }, \"cache_efficiency\": { \"hit_ratio\": cache_hit_ratio, \"status\": \"good\" if cache_hit_ratio \u003e 0.8 else \"needs_improvement\" } } recommendations = [] if response_time \u003e 200: recommendations.append(\"考虑使用CDN或优化服务器响应时间\") if response_size \u003e 1024 * 1024: recommendations.append(\"启用压缩或优化响应内容\") if cache_hit_ratio \u003c 0.8: recommendations.append(\"优化缓存策略\") analysis[\"recommendations\"] = recommendations return analysis # 示例使用 api = WebAPIBestPractices() # 设计成功响应 success_response = api.design_api_response( data={\"id\": 1, \"name\": \"张三\", \"email\": \"zhangsan@example.com\"} ) print(\"成功响应:\", success_response) # 设计错误响应 error_response = api.design_api_response( error={ \"code\": \"VALIDATION_ERROR\", \"message\": \"请求数据验证失败\", \"details\": [\"邮箱格式不正确\", \"密码长度不足\"] } ) print(\"错误响应:\", error_response) # 分页响应 users = [{\"id\": i, \"name\": f\"用户{i}\"} for i in range(1, 101)] paginated = api.paginate_response(users, page=2, per_page=10) print(\"分页响应:\", paginated) # 性能分析 perf = HTTPPerformanceOptimization() analysis = perf.analyze_performance( response_time=150, # ms response_size=512 * 1024, # bytes cache_hit_ratio=0.75 ) print(\"性能分析:\", analysis) 学习建议和总结 HTTP学习路径 基础概念：理解HTTP的工作原理和特点 协议细节：掌握请求响应格式、状态码、头字段 缓存机制：学习HTTP缓存策略和实现 安全机制：了解HTTPS、CORS、安全头等 性能优化：掌握HTTP性能优化技巧 新版本特性：学习HTTP/2和HTTP/3的新特性 关键要点总结 方面 要点 实践建议 请求方法 正确使用GET、POST、PUT、DELETE等 遵循RESTful设计原则 状态码 返回合适的HTTP状态码 提供清晰的错误信息 缓存 合理设置缓存策略 平衡性能和数据新鲜度 安全 实施适当的安全措施 使用HTTPS和安全头 性能 优化请求和响应 使用压缩和CDN 实际应用建议 API设计：遵循RESTful原则，保持接口一致性 错误处理：提供详细的错误信息和处理建议 文档化：维护完整的API文档 监控：实施性能监控和日志记录 版本控制：合理管理API版本 HTTP协议是Web开发的基础，深入理解其工作原理和最佳实践对于构建高质量的Web应用至关重要。随着HTTP/2和HTTP/3的普及，掌握新特性将有助于进一步提升应用性能。\n",
  "wordCount" : "3042",
  "inLanguage": "en",
  "image":"https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=800\u0026h=400\u0026fit=crop","datePublished": "2024-02-28T10:15:00+08:00",
  "dateModified": "2025-08-06T08:51:21+08:00",
  "author":{
    "@type": "Person",
    "name": "tyhzxh"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://tyhzxh.github.io/posts/http-protocol-guide/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "tyhzxh的个人博客",
    "logo": {
      "@type": "ImageObject",
      "url": "https://tyhzxh.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://tyhzxh.github.io/" accesskey="h" title="tyhzxh的个人博客 (Alt + H)">tyhzxh的个人博客</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://tyhzxh.github.io/" title="首页">
                    <span>首页</span>
                </a>
            </li>
            <li>
                <a href="https://tyhzxh.github.io/posts/" title="文章">
                    <span>文章</span>
                </a>
            </li>
            <li>
                <a href="https://tyhzxh.github.io/archives/" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="https://tyhzxh.github.io/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="https://tyhzxh.github.io/search/" title="搜索 (Alt &#43; /)" accesskey=/>
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="https://tyhzxh.github.io/about/" title="关于">
                    <span>关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://tyhzxh.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://tyhzxh.github.io/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      HTTP协议详解：从基础到高级应用
    </h1>
    <div class="post-description">
      深入解析HTTP协议的工作原理、请求响应机制、状态码、缓存策略、安全机制以及HTTP/2和HTTP/3的新特性，涵盖Web开发中的实际应用
    </div>
    <div class="post-meta"><span title='2024-02-28 10:15:00 +0800 CST'>February 28, 2024</span>&nbsp;·&nbsp;15 min&nbsp;·&nbsp;tyhzxh

</div>
  </header> 
<figure class="entry-cover">
        <img loading="eager" src="https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=800&amp;h=400&amp;fit=crop" alt="HTTP协议与Web通信">
        
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#http%e5%8d%8f%e8%ae%ae%e6%a6%82%e8%bf%b0" aria-label="HTTP协议概述">HTTP协议概述</a><ul>
                        
                <li>
                    <a href="#http%e7%9a%84%e6%a0%b8%e5%bf%83%e7%89%b9%e7%82%b9" aria-label="HTTP的核心特点">HTTP的核心特点</a></li></ul>
                </li>
                <li>
                    <a href="#http%e5%8d%8f%e8%ae%ae%e7%89%88%e6%9c%ac%e6%bc%94%e8%bf%9b" aria-label="HTTP协议版本演进">HTTP协议版本演进</a><ul>
                        
                <li>
                    <a href="#http10-vs-http11-vs-http2-vs-http3" aria-label="HTTP/1.0 vs HTTP/1.1 vs HTTP/2 vs HTTP/3">HTTP/1.0 vs HTTP/1.1 vs HTTP/2 vs HTTP/3</a></li></ul>
                </li>
                <li>
                    <a href="#http%e8%af%b7%e6%b1%82%e5%92%8c%e5%93%8d%e5%ba%94%e7%bb%93%e6%9e%84" aria-label="HTTP请求和响应结构">HTTP请求和响应结构</a><ul>
                        
                <li>
                    <a href="#http%e8%af%b7%e6%b1%82%e7%bb%93%e6%9e%84" aria-label="HTTP请求结构">HTTP请求结构</a><ul>
                        
                <li>
                    <a href="#%e8%af%b7%e6%b1%82%e7%bb%93%e6%9e%84%e8%a7%a3%e6%9e%90" aria-label="请求结构解析">请求结构解析</a></li></ul>
                </li>
                <li>
                    <a href="#http%e5%93%8d%e5%ba%94%e7%bb%93%e6%9e%84" aria-label="HTTP响应结构">HTTP响应结构</a><ul>
                        
                <li>
                    <a href="#%e5%93%8d%e5%ba%94%e7%bb%93%e6%9e%84%e8%a7%a3%e6%9e%90" aria-label="响应结构解析">响应结构解析</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#http%e6%96%b9%e6%b3%95%e8%af%a6%e8%a7%a3" aria-label="HTTP方法详解">HTTP方法详解</a><ul>
                        
                <li>
                    <a href="#%e5%b8%b8%e7%94%a8http%e6%96%b9%e6%b3%95" aria-label="常用HTTP方法">常用HTTP方法</a></li></ul>
                </li>
                <li>
                    <a href="#http%e7%8a%b6%e6%80%81%e7%a0%81%e8%af%a6%e8%a7%a3" aria-label="HTTP状态码详解">HTTP状态码详解</a><ul>
                        
                <li>
                    <a href="#%e7%8a%b6%e6%80%81%e7%a0%81%e5%88%86%e7%b1%bb%e5%92%8c%e5%90%ab%e4%b9%89" aria-label="状态码分类和含义">状态码分类和含义</a></li></ul>
                </li>
                <li>
                    <a href="#http%e5%a4%b4%e5%ad%97%e6%ae%b5%e8%af%a6%e8%a7%a3" aria-label="HTTP头字段详解">HTTP头字段详解</a><ul>
                        
                <li>
                    <a href="#%e5%b8%b8%e7%94%a8%e8%af%b7%e6%b1%82%e5%a4%b4" aria-label="常用请求头">常用请求头</a></li></ul>
                </li>
                <li>
                    <a href="#http%e7%bc%93%e5%ad%98%e6%9c%ba%e5%88%b6" aria-label="HTTP缓存机制">HTTP缓存机制</a><ul>
                        
                <li>
                    <a href="#%e7%bc%93%e5%ad%98%e7%ad%96%e7%95%a5%e8%af%a6%e8%a7%a3" aria-label="缓存策略详解">缓存策略详解</a></li></ul>
                </li>
                <li>
                    <a href="#http%e5%ae%89%e5%85%a8%e6%9c%ba%e5%88%b6" aria-label="HTTP安全机制">HTTP安全机制</a><ul>
                        
                <li>
                    <a href="#https%e5%92%8c%e5%ae%89%e5%85%a8%e5%a4%b4" aria-label="HTTPS和安全头">HTTPS和安全头</a></li></ul>
                </li>
                <li>
                    <a href="#http2-%e5%92%8c-http3-%e6%96%b0%e7%89%b9%e6%80%a7" aria-label="HTTP/2 和 HTTP/3 新特性">HTTP/2 和 HTTP/3 新特性</a><ul>
                        
                <li>
                    <a href="#http2-%e7%89%b9%e6%80%a7" aria-label="HTTP/2 特性">HTTP/2 特性</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ae%9e%e9%99%85%e5%ba%94%e7%94%a8%e5%92%8c%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5" aria-label="实际应用和最佳实践">实际应用和最佳实践</a><ul>
                        
                <li>
                    <a href="#web-api%e8%ae%be%e8%ae%a1%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5" aria-label="Web API设计最佳实践">Web API设计最佳实践</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ad%a6%e4%b9%a0%e5%bb%ba%e8%ae%ae%e5%92%8c%e6%80%bb%e7%bb%93" aria-label="学习建议和总结">学习建议和总结</a><ul>
                        
                <li>
                    <a href="#http%e5%ad%a6%e4%b9%a0%e8%b7%af%e5%be%84" aria-label="HTTP学习路径">HTTP学习路径</a></li>
                <li>
                    <a href="#%e5%85%b3%e9%94%ae%e8%a6%81%e7%82%b9%e6%80%bb%e7%bb%93" aria-label="关键要点总结">关键要点总结</a></li>
                <li>
                    <a href="#%e5%ae%9e%e9%99%85%e5%ba%94%e7%94%a8%e5%bb%ba%e8%ae%ae" aria-label="实际应用建议">实际应用建议</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="http协议概述">HTTP协议概述<a hidden class="anchor" aria-hidden="true" href="#http协议概述">#</a></h2>
<p>**HTTP（HyperText Transfer Protocol）**是互联网上应用最广泛的网络协议之一，是Web的基础。它定义了客户端和服务器之间如何进行通信，是一个基于请求-响应模式的、无状态的应用层协议。</p>
<h3 id="http的核心特点">HTTP的核心特点<a hidden class="anchor" aria-hidden="true" href="#http的核心特点">#</a></h3>
<table>
  <thead>
      <tr>
          <th>特点</th>
          <th>描述</th>
          <th>影响</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>无状态</strong></td>
          <td>每个请求都是独立的</td>
          <td>需要额外机制保持状态</td>
      </tr>
      <tr>
          <td><strong>无连接</strong></td>
          <td>请求完成后断开连接</td>
          <td>HTTP/1.1引入持久连接</td>
      </tr>
      <tr>
          <td><strong>简单快速</strong></td>
          <td>协议简单，处理速度快</td>
          <td>易于实现和调试</td>
      </tr>
      <tr>
          <td><strong>灵活</strong></td>
          <td>支持多种数据类型</td>
          <td>可传输任意类型数据</td>
      </tr>
  </tbody>
</table>
<h2 id="http协议版本演进">HTTP协议版本演进<a hidden class="anchor" aria-hidden="true" href="#http协议版本演进">#</a></h2>
<h3 id="http10-vs-http11-vs-http2-vs-http3">HTTP/1.0 vs HTTP/1.1 vs HTTP/2 vs HTTP/3<a hidden class="anchor" aria-hidden="true" href="#http10-vs-http11-vs-http2-vs-http3">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># HTTP版本特性对比</span>
</span></span><span class="line"><span class="cl"><span class="n">http_versions</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;HTTP/1.0&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;发布年份&#34;</span><span class="p">:</span> <span class="mi">1996</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;主要特性&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;基本的请求-响应机制&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;支持GET、POST、HEAD方法&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;每个请求建立新连接&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;缺点&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;连接开销大&#34;</span><span class="p">,</span> <span class="s2">&#34;无法复用连接&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;HTTP/1.1&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;发布年份&#34;</span><span class="p">:</span> <span class="mi">1997</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;主要特性&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;持久连接（Keep-Alive）&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;管道化（Pipelining）&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;分块传输编码&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Host头字段&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;更多HTTP方法&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;改进&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;减少连接开销&#34;</span><span class="p">,</span> <span class="s2">&#34;支持虚拟主机&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;HTTP/2&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;发布年份&#34;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;主要特性&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;二进制分帧&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;多路复用&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;头部压缩（HPACK）&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;服务器推送&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;流优先级&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;性能提升&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;解决队头阻塞&#34;</span><span class="p">,</span> <span class="s2">&#34;减少延迟&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;HTTP/3&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;发布年份&#34;</span><span class="p">:</span> <span class="mi">2022</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;主要特性&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;基于QUIC协议&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;UDP传输&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;内置加密&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;连接迁移&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;0-RTT连接建立&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;优势&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;更快的连接建立&#34;</span><span class="p">,</span> <span class="s2">&#34;更好的移动网络支持&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">version</span><span class="p">,</span> <span class="n">details</span> <span class="ow">in</span> <span class="n">http_versions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">details</span><span class="p">[</span><span class="s1">&#39;发布年份&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">年):&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;主要特性&#39;</span><span class="p">,</span> <span class="p">[]):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  • </span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="http请求和响应结构">HTTP请求和响应结构<a hidden class="anchor" aria-hidden="true" href="#http请求和响应结构">#</a></h2>
<h3 id="http请求结构">HTTP请求结构<a hidden class="anchor" aria-hidden="true" href="#http请求结构">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/api/users/123</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">api.example.com</span>
</span></span><span class="line"><span class="cl"><span class="n">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept</span><span class="o">:</span> <span class="l">application/json</span>
</span></span><span class="line"><span class="cl"><span class="n">Authorization</span><span class="o">:</span> <span class="l">Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Length</span><span class="o">:</span> <span class="l">85</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;张三&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;zhangsan@example.com&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="请求结构解析">请求结构解析<a hidden class="anchor" aria-hidden="true" href="#请求结构解析">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HTTPRequest</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;HTTP请求结构解析&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">raw_request</span> <span class="o">=</span> <span class="n">raw_request</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">parse_request</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">parse_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;解析HTTP请求&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_request</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 解析请求行</span>
</span></span><span class="line"><span class="cl">        <span class="n">request_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">request_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 解析请求头</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="n">body_start</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">body_start</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 解析请求体</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">body_start</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">body_start</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;获取请求信息&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;method&#34;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;path&#34;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;version&#34;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;headers&#34;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;body&#34;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 示例使用</span>
</span></span><span class="line"><span class="cl"><span class="n">sample_request</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;GET /api/users HTTP/1.1
</span></span></span><span class="line"><span class="cl"><span class="s2">Host: api.example.com
</span></span></span><span class="line"><span class="cl"><span class="s2">User-Agent: Mozilla/5.0
</span></span></span><span class="line"><span class="cl"><span class="s2">Accept: application/json
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">request</span> <span class="o">=</span> <span class="n">HTTPRequest</span><span class="p">(</span><span class="n">sample_request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;请求信息:&#34;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">get_info</span><span class="p">())</span>
</span></span></code></pre></div><h3 id="http响应结构">HTTP响应结构<a hidden class="anchor" aria-hidden="true" href="#http响应结构">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">Date</span><span class="o">:</span> <span class="l">Mon, 27 Feb 2024 10:15:30 GMT</span>
</span></span><span class="line"><span class="cl"><span class="n">Server</span><span class="o">:</span> <span class="l">nginx/1.18.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Type</span><span class="o">:</span> <span class="l">application/json; charset=utf-8</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Length</span><span class="o">:</span> <span class="l">156</span>
</span></span><span class="line"><span class="cl"><span class="n">Cache-Control</span><span class="o">:</span> <span class="l">max-age=3600</span>
</span></span><span class="line"><span class="cl"><span class="n">ETag</span><span class="o">:</span> <span class="l">&#34;33a64df551425fcc55e4d42a148795d9f25f89d4&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">Access-Control-Allow-Origin</span><span class="o">:</span> <span class="l">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;张三&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;zhangsan@example.com&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;created_at&#34;</span><span class="p">:</span> <span class="s2">&#34;2024-02-27T10:15:30Z&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;active&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="响应结构解析">响应结构解析<a hidden class="anchor" aria-hidden="true" href="#响应结构解析">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HTTPResponse</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;HTTP响应结构解析&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_response</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">raw_response</span> <span class="o">=</span> <span class="n">raw_response</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">parse_response</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">parse_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;解析HTTP响应&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_response</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 解析状态行</span>
</span></span><span class="line"><span class="cl">        <span class="n">status_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">parts</span> <span class="o">=</span> <span class="n">status_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">reason_phrase</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 解析响应头</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="n">body_start</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">body_start</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 解析响应体</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">body_start</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">body_start</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">is_success</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;判断是否成功响应&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">200</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;</span> <span class="mi">300</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;获取响应信息&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;version&#34;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;status_code&#34;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;reason_phrase&#34;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">reason_phrase</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;headers&#34;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;body&#34;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;is_success&#34;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_success</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></div><h2 id="http方法详解">HTTP方法详解<a hidden class="anchor" aria-hidden="true" href="#http方法详解">#</a></h2>
<h3 id="常用http方法">常用HTTP方法<a hidden class="anchor" aria-hidden="true" href="#常用http方法">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HTTPMethods</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;HTTP方法详解和示例&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nd">@staticmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_method_info</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;获取HTTP方法信息&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">methods</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;GET&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;获取资源&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;特点&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;安全&#34;</span><span class="p">,</span> <span class="s2">&#34;幂等&#34;</span><span class="p">,</span> <span class="s2">&#34;可缓存&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;GET /api/users/123&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;POST&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;创建资源或提交数据&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;特点&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;不安全&#34;</span><span class="p">,</span> <span class="s2">&#34;非幂等&#34;</span><span class="p">,</span> <span class="s2">&#34;不可缓存&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;POST /api/users&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;PUT&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;更新或创建资源&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;特点&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;不安全&#34;</span><span class="p">,</span> <span class="s2">&#34;幂等&#34;</span><span class="p">,</span> <span class="s2">&#34;不可缓存&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;PUT /api/users/123&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;DELETE&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;删除资源&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;特点&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;不安全&#34;</span><span class="p">,</span> <span class="s2">&#34;幂等&#34;</span><span class="p">,</span> <span class="s2">&#34;不可缓存&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;DELETE /api/users/123&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;PATCH&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;部分更新资源&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;特点&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;不安全&#34;</span><span class="p">,</span> <span class="s2">&#34;非幂等&#34;</span><span class="p">,</span> <span class="s2">&#34;不可缓存&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;PATCH /api/users/123&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;HEAD&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;获取资源头信息&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;特点&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;安全&#34;</span><span class="p">,</span> <span class="s2">&#34;幂等&#34;</span><span class="p">,</span> <span class="s2">&#34;可缓存&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;HEAD /api/users/123&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;OPTIONS&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;获取服务器支持的方法&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;特点&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;安全&#34;</span><span class="p">,</span> <span class="s2">&#34;幂等&#34;</span><span class="p">,</span> <span class="s2">&#34;不可缓存&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;OPTIONS /api/users&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">methods</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># RESTful API设计示例</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RESTfulAPI</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;RESTful API设计示例&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">next_id</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;处理HTTP请求&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/api/users&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;/api/users&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_users</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">user_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_id</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span> <span class="ow">and</span> <span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;/api/users&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;PUT&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">user_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_id</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">user_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_id</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;PATCH&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">user_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_id</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;Not Found&#34;</span><span class="p">,</span> <span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="mi">404</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">extract_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;从路径中提取ID&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">parts</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_users</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;获取所有用户&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;users&#34;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;获取单个用户&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;user&#34;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">],</span> <span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;User not found&#34;</span><span class="p">,</span> <span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="mi">404</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;创建用户&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_id</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">next_id</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">user</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;name&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;email&#34;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;email&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;created_at&#34;</span><span class="p">:</span> <span class="s2">&#34;2024-02-27T10:15:30Z&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;user&#34;</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span> <span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="mi">201</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">update_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;更新用户（完整替换）&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">user</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;name&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;email&#34;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;email&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;updated_at&#34;</span><span class="p">:</span> <span class="s2">&#34;2024-02-27T10:15:30Z&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;user&#34;</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span> <span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">patch_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;部分更新用户&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;User not found&#34;</span><span class="p">,</span> <span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="mi">404</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">user</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">user</span><span class="p">[</span><span class="s2">&#34;updated_at&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;2024-02-27T10:15:30Z&#34;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;user&#34;</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span> <span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">delete_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;删除用户&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;User deleted&#34;</span><span class="p">,</span> <span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="mi">204</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;User not found&#34;</span><span class="p">,</span> <span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="mi">404</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 示例使用</span>
</span></span><span class="line"><span class="cl"><span class="n">api</span> <span class="o">=</span> <span class="n">RESTfulAPI</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建用户</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">handle_request</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;/api/users&#39;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;张三&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;zhangsan@example.com&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;创建用户:&#34;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 获取用户</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">handle_request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/api/users/1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;获取用户:&#34;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 更新用户</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">handle_request</span><span class="p">(</span><span class="s1">&#39;PATCH&#39;</span><span class="p">,</span> <span class="s1">&#39;/api/users/1&#39;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;张三丰&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;更新用户:&#34;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="http状态码详解">HTTP状态码详解<a hidden class="anchor" aria-hidden="true" href="#http状态码详解">#</a></h2>
<h3 id="状态码分类和含义">状态码分类和含义<a hidden class="anchor" aria-hidden="true" href="#状态码分类和含义">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HTTPStatusCodes</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;HTTP状态码详解&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">status_codes</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># 1xx 信息性状态码</span>
</span></span><span class="line"><span class="cl">            <span class="mi">100</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Continue&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;继续请求&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">101</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Switching Protocols&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;切换协议&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">102</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Processing&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;处理中&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># 2xx 成功状态码</span>
</span></span><span class="line"><span class="cl">            <span class="mi">200</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;OK&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;请求成功&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">201</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Created&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;资源已创建&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">202</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Accepted&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;请求已接受&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">204</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;No Content&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;无内容&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">206</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Partial Content&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;部分内容&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># 3xx 重定向状态码</span>
</span></span><span class="line"><span class="cl">            <span class="mi">301</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Moved Permanently&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;永久重定向&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">302</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Found&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;临时重定向&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">304</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Not Modified&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;未修改&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">307</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Temporary Redirect&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;临时重定向&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">308</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Permanent Redirect&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;永久重定向&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># 4xx 客户端错误状态码</span>
</span></span><span class="line"><span class="cl">            <span class="mi">400</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Bad Request&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;请求错误&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">401</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Unauthorized&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;未授权&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">403</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Forbidden&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;禁止访问&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">404</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Not Found&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;资源未找到&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">405</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Method Not Allowed&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;方法不允许&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">409</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Conflict&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;冲突&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">422</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Unprocessable Entity&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;无法处理的实体&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">429</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Too Many Requests&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;请求过多&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># 5xx 服务器错误状态码</span>
</span></span><span class="line"><span class="cl">            <span class="mi">500</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Internal Server Error&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;服务器内部错误&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">501</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Not Implemented&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;未实现&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">502</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Bad Gateway&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;网关错误&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">503</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Service Unavailable&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;服务不可用&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="mi">504</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Gateway Timeout&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;网关超时&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_status_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;获取状态码信息&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_codes</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_codes</span><span class="p">[</span><span class="n">code</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Unknown&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;未知状态码&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;获取状态码类别&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="mi">100</span> <span class="o">&lt;=</span> <span class="n">code</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;信息性响应&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="mi">200</span> <span class="o">&lt;=</span> <span class="n">code</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;成功响应&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="mi">300</span> <span class="o">&lt;=</span> <span class="n">code</span> <span class="o">&lt;</span> <span class="mi">400</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;重定向&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="mi">400</span> <span class="o">&lt;=</span> <span class="n">code</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;客户端错误&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="mi">500</span> <span class="o">&lt;=</span> <span class="n">code</span> <span class="o">&lt;</span> <span class="mi">600</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;服务器错误&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;未知类别&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">is_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;判断是否为错误状态码&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">code</span> <span class="o">&gt;=</span> <span class="mi">400</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 状态码使用示例</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">handle_api_response</span><span class="p">(</span><span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;处理API响应&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">status_handler</span> <span class="o">=</span> <span class="n">HTTPStatusCodes</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">info</span> <span class="o">=</span> <span class="n">status_handler</span><span class="o">.</span><span class="n">get_status_info</span><span class="p">(</span><span class="n">status_code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">category</span> <span class="o">=</span> <span class="n">status_handler</span><span class="o">.</span><span class="n">get_category</span><span class="p">(</span><span class="n">status_code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;status_code&#34;</span><span class="p">:</span> <span class="n">status_code</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;status_name&#34;</span><span class="p">:</span> <span class="n">info</span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="n">info</span><span class="p">[</span><span class="s2">&#34;description&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;category&#34;</span><span class="p">:</span> <span class="n">category</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;is_error&#34;</span><span class="p">:</span> <span class="n">status_handler</span><span class="o">.</span><span class="n">is_error</span><span class="p">(</span><span class="n">status_code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span><span class="p">[</span><span class="s2">&#34;data&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 示例使用</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;成功响应:&#34;</span><span class="p">,</span> <span class="n">handle_api_response</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;操作成功&#34;</span><span class="p">}))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;客户端错误:&#34;</span><span class="p">,</span> <span class="n">handle_api_response</span><span class="p">(</span><span class="mi">404</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;服务器错误:&#34;</span><span class="p">,</span> <span class="n">handle_api_response</span><span class="p">(</span><span class="mi">500</span><span class="p">))</span>
</span></span></code></pre></div><h2 id="http头字段详解">HTTP头字段详解<a hidden class="anchor" aria-hidden="true" href="#http头字段详解">#</a></h2>
<h3 id="常用请求头">常用请求头<a hidden class="anchor" aria-hidden="true" href="#常用请求头">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HTTPHeaders</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;HTTP头字段详解&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">request_headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Accept&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;指定客户端能够接收的内容类型&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Accept: application/json, text/html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;高&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Accept-Encoding&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;指定客户端支持的编码格式&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Accept-Encoding: gzip, deflate, br&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;中&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Accept-Language&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;指定客户端偏好的语言&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;中&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Authorization&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;包含认证凭据&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Authorization: Bearer eyJhbGciOiJIUzI1NiIs...&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;高&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Cache-Control&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;指定缓存机制&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Cache-Control: no-cache, max-age=0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;高&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Content-Type&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;指定请求体的媒体类型&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Content-Type: application/json; charset=utf-8&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;高&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Cookie&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;发送存储的Cookie&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Cookie: sessionid=abc123; csrftoken=xyz789&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;高&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Host&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;指定服务器的域名和端口&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Host: api.example.com:443&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;必需&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Referer&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;指定请求来源页面&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Referer: https://example.com/page&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;中&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;User-Agent&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;标识客户端应用程序&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;中&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">response_headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Access-Control-Allow-Origin&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;CORS跨域访问控制&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Access-Control-Allow-Origin: *&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;高&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Cache-Control&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;指定缓存策略&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Cache-Control: public, max-age=3600&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;高&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Content-Encoding&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;指定内容编码格式&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Content-Encoding: gzip&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;中&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Content-Length&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;指定响应体长度&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Content-Length: 1024&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;高&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Content-Type&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;指定响应体的媒体类型&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Content-Type: application/json; charset=utf-8&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;高&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;ETag&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;资源的唯一标识符&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;ETag: </span><span class="se">\&#34;</span><span class="s2">33a64df551425fcc55e4d42a148795d9f25f89d4</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;中&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Expires&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;指定资源过期时间&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Expires: Wed, 21 Oct 2024 07:28:00 GMT&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;中&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Last-Modified&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;资源最后修改时间&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Last-Modified: Wed, 21 Oct 2024 07:28:00 GMT&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;中&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Location&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;重定向的目标URL&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Location: https://example.com/new-page&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;高&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Set-Cookie&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;设置Cookie&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Set-Cookie: sessionid=abc123; HttpOnly; Secure&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;重要性&#34;</span><span class="p">:</span> <span class="s2">&#34;高&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 头字段处理示例</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HeaderProcessor</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;HTTP头字段处理器&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">add_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;添加头字段&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;获取内容类型&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">content_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;;&#39;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">content_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">content_type</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;获取字符编码&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">content_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;charset=&#39;</span> <span class="ow">in</span> <span class="n">content_type</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">content_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;charset=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;utf-8&#39;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">is_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;判断是否为JSON格式&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;application/json&#39;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_cache_control</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;解析Cache-Control头&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">cache_control</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Cache-Control&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">directives</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">directive</span> <span class="ow">in</span> <span class="n">cache_control</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">directive</span> <span class="o">=</span> <span class="n">directive</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">directive</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">directive</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">directives</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">directives</span><span class="p">[</span><span class="n">directive</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">directives</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_authorization_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;获取认证类型&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">auth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">auth</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">auth</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 示例使用</span>
</span></span><span class="line"><span class="cl"><span class="n">processor</span> <span class="o">=</span> <span class="n">HeaderProcessor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">processor</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/json; charset=utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">processor</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s1">&#39;Cache-Control&#39;</span><span class="p">,</span> <span class="s1">&#39;public, max-age=3600, must-revalidate&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">processor</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span> <span class="s1">&#39;Bearer eyJhbGciOiJIUzI1NiIs...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;内容类型:&#34;</span><span class="p">,</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;字符编码:&#34;</span><span class="p">,</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_charset</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;是否JSON:&#34;</span><span class="p">,</span> <span class="n">processor</span><span class="o">.</span><span class="n">is_json</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;缓存控制:&#34;</span><span class="p">,</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_cache_control</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;认证类型:&#34;</span><span class="p">,</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_authorization_type</span><span class="p">())</span>
</span></span></code></pre></div><h2 id="http缓存机制">HTTP缓存机制<a hidden class="anchor" aria-hidden="true" href="#http缓存机制">#</a></h2>
<h3 id="缓存策略详解">缓存策略详解<a hidden class="anchor" aria-hidden="true" href="#缓存策略详解">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HTTPCache</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;HTTP缓存机制实现&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">generate_etag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;生成ETag&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">is_fresh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache_entry</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;检查缓存是否新鲜&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;expires&#39;</span> <span class="ow">in</span> <span class="n">cache_entry</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">cache_entry</span><span class="p">[</span><span class="s1">&#39;expires&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;max_age&#39;</span> <span class="ow">in</span> <span class="n">cache_entry</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">age</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">cache_entry</span><span class="p">[</span><span class="s1">&#39;cached_at&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">age</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">cache_entry</span><span class="p">[</span><span class="s1">&#39;max_age&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">handle_cache_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;处理缓存请求&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">headers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">cache_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 检查是否有缓存</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">cache_entry</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;cache_status&#34;</span><span class="p">:</span> <span class="s2">&#34;MISS&#34;</span><span class="p">,</span> <span class="s2">&#34;should_fetch&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 检查缓存是否新鲜</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fresh</span><span class="p">(</span><span class="n">cache_entry</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;cache_status&#34;</span><span class="p">:</span> <span class="s2">&#34;STALE&#34;</span><span class="p">,</span> <span class="s2">&#34;should_fetch&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 检查条件请求</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;If-None-Match&#39;</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;If-None-Match&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cache_entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;etag&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;cache_status&#34;</span><span class="p">:</span> <span class="s2">&#34;NOT_MODIFIED&#34;</span><span class="p">,</span> <span class="s2">&#34;should_fetch&#34;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;If-Modified-Since&#39;</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">if_modified</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;If-Modified-Since&#39;</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                                          <span class="s1">&#39;</span><span class="si">%a</span><span class="s1">, </span><span class="si">%d</span><span class="s1"> %b %Y %H:%M:%S GMT&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">cache_entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;last_modified&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">if_modified</span> <span class="o">&gt;=</span> <span class="n">cache_entry</span><span class="p">[</span><span class="s1">&#39;last_modified&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;cache_status&#34;</span><span class="p">:</span> <span class="s2">&#34;NOT_MODIFIED&#34;</span><span class="p">,</span> <span class="s2">&#34;should_fetch&#34;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;cache_status&#34;</span><span class="p">:</span> <span class="s2">&#34;HIT&#34;</span><span class="p">,</span> <span class="s2">&#34;should_fetch&#34;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="n">cache_entry</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">store_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">response_data</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;存储响应到缓存&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">cache_entry</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="n">response_data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;cached_at&#34;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;headers&#34;</span><span class="p">:</span> <span class="n">headers</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 处理ETag</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;ETag&#39;</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">cache_entry</span><span class="p">[</span><span class="s1">&#39;etag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;ETag&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 处理Last-Modified</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;Last-Modified&#39;</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">cache_entry</span><span class="p">[</span><span class="s1">&#39;last_modified&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Last-Modified&#39;</span><span class="p">],</span> <span class="s1">&#39;</span><span class="si">%a</span><span class="s1">, </span><span class="si">%d</span><span class="s1"> %b %Y %H:%M:%S GMT&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 处理Expires</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;Expires&#39;</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">cache_entry</span><span class="p">[</span><span class="s1">&#39;expires&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Expires&#39;</span><span class="p">],</span> <span class="s1">&#39;</span><span class="si">%a</span><span class="s1">, </span><span class="si">%d</span><span class="s1"> %b %Y %H:%M:%S GMT&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 处理Cache-Control</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;Cache-Control&#39;</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">cache_control</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_cache_control</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Cache-Control&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s1">&#39;max-age&#39;</span> <span class="ow">in</span> <span class="n">cache_control</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">cache_entry</span><span class="p">[</span><span class="s1">&#39;max_age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cache_control</span><span class="p">[</span><span class="s1">&#39;max-age&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s1">&#39;no-cache&#39;</span> <span class="ow">in</span> <span class="n">cache_control</span> <span class="ow">or</span> <span class="s1">&#39;no-store&#39;</span> <span class="ow">in</span> <span class="n">cache_control</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span>  <span class="c1"># 不缓存</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">url</span><span class="p">]</span> <span class="o">=</span> <span class="n">cache_entry</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">parse_cache_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache_control_header</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;解析Cache-Control头&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">directives</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">directive</span> <span class="ow">in</span> <span class="n">cache_control_header</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">directive</span> <span class="o">=</span> <span class="n">directive</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">directive</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">directive</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">directives</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">directives</span><span class="p">[</span><span class="n">directive</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">directives</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 缓存策略示例</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CacheStrategy</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;缓存策略示例&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nd">@staticmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_cache_headers</span><span class="p">(</span><span class="n">resource_type</span><span class="p">,</span> <span class="n">max_age</span><span class="o">=</span><span class="mi">3600</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;根据资源类型获取缓存头&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">strategies</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;static&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Cache-Control&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;public, max-age=</span><span class="si">{</span><span class="n">max_age</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">365</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span>  <span class="c1"># 1年</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Expires&#34;</span><span class="p">:</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;</span><span class="si">%a</span><span class="s1">, </span><span class="si">%d</span><span class="s1"> %b %Y %H:%M:%S GMT&#39;</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;api&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Cache-Control&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;private, max-age=</span><span class="si">{</span><span class="n">max_age</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span>  <span class="c1"># 1小时</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;ETag&#34;</span><span class="p">:</span> <span class="s1">&#39;&#34;&#39;</span> <span class="o">+</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;&#34;&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;dynamic&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Cache-Control&#34;</span><span class="p">:</span> <span class="s2">&#34;no-cache, must-revalidate&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Pragma&#34;</span><span class="p">:</span> <span class="s2">&#34;no-cache&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;sensitive&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Cache-Control&#34;</span><span class="p">:</span> <span class="s2">&#34;no-store, no-cache, must-revalidate&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Pragma&#34;</span><span class="p">:</span> <span class="s2">&#34;no-cache&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Expires&#34;</span><span class="p">:</span> <span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">strategies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">resource_type</span><span class="p">,</span> <span class="n">strategies</span><span class="p">[</span><span class="s2">&#34;dynamic&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 示例使用</span>
</span></span><span class="line"><span class="cl"><span class="n">cache</span> <span class="o">=</span> <span class="n">HTTPCache</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 模拟第一次请求</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;https://api.example.com/users&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">handle_cache_request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;第一次请求:&#34;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 存储响应</span>
</span></span><span class="line"><span class="cl"><span class="n">response_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;users&#34;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;张三&#34;</span><span class="p">}]}</span>
</span></span><span class="line"><span class="cl"><span class="n">response_headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Cache-Control&#34;</span><span class="p">:</span> <span class="s2">&#34;public, max-age=3600&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ETag&#34;</span><span class="p">:</span> <span class="s1">&#39;&#34;abc123&#34;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Last-Modified&#34;</span><span class="p">:</span> <span class="s2">&#34;Mon, 27 Feb 2024 10:15:30 GMT&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">cache</span><span class="o">.</span><span class="n">store_response</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">response_data</span><span class="p">,</span> <span class="n">response_headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 模拟第二次请求</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">handle_cache_request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;第二次请求:&#34;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 模拟条件请求</span>
</span></span><span class="line"><span class="cl"><span class="n">conditional_headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;If-None-Match&#34;</span><span class="p">:</span> <span class="s1">&#39;&#34;abc123&#34;&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">handle_cache_request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">conditional_headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;条件请求:&#34;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="http安全机制">HTTP安全机制<a hidden class="anchor" aria-hidden="true" href="#http安全机制">#</a></h2>
<h3 id="https和安全头">HTTPS和安全头<a hidden class="anchor" aria-hidden="true" href="#https和安全头">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HTTPSecurity</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;HTTP安全机制&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">security_headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Strict-Transport-Security&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;强制使用HTTPS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Strict-Transport-Security: max-age=31536000; includeSubDomains&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;防护&#34;</span><span class="p">:</span> <span class="s2">&#34;中间人攻击&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Content-Security-Policy&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;防止XSS攻击&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Content-Security-Policy: default-src &#39;self&#39;; script-src &#39;self&#39; &#39;unsafe-inline&#39;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;防护&#34;</span><span class="p">:</span> <span class="s2">&#34;跨站脚本攻击&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;X-Frame-Options&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;防止点击劫持&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;X-Frame-Options: DENY&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;防护&#34;</span><span class="p">:</span> <span class="s2">&#34;点击劫持攻击&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;X-Content-Type-Options&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;防止MIME类型嗅探&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;X-Content-Type-Options: nosniff&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;防护&#34;</span><span class="p">:</span> <span class="s2">&#34;MIME嗅探攻击&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;X-XSS-Protection&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;启用XSS过滤器&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;X-XSS-Protection: 1; mode=block&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;防护&#34;</span><span class="p">:</span> <span class="s2">&#34;反射型XSS攻击&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Referrer-Policy&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;用途&#34;</span><span class="p">:</span> <span class="s2">&#34;控制Referer头信息&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;示例&#34;</span><span class="p">:</span> <span class="s2">&#34;Referrer-Policy: strict-origin-when-cross-origin&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;防护&#34;</span><span class="p">:</span> <span class="s2">&#34;信息泄露&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_security_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">security_level</span><span class="o">=</span><span class="s2">&#34;high&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;获取安全头配置&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">security_level</span> <span class="o">==</span> <span class="s2">&#34;high&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Strict-Transport-Security&#34;</span><span class="p">:</span> <span class="s2">&#34;max-age=31536000; includeSubDomains; preload&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Content-Security-Policy&#34;</span><span class="p">:</span> <span class="s2">&#34;default-src &#39;self&#39;; script-src &#39;self&#39;; style-src &#39;self&#39; &#39;unsafe-inline&#39;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;X-Frame-Options&#34;</span><span class="p">:</span> <span class="s2">&#34;DENY&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;X-Content-Type-Options&#34;</span><span class="p">:</span> <span class="s2">&#34;nosniff&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;X-XSS-Protection&#34;</span><span class="p">:</span> <span class="s2">&#34;1; mode=block&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Referrer-Policy&#34;</span><span class="p">:</span> <span class="s2">&#34;strict-origin-when-cross-origin&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">security_level</span> <span class="o">==</span> <span class="s2">&#34;medium&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Strict-Transport-Security&#34;</span><span class="p">:</span> <span class="s2">&#34;max-age=31536000&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Content-Security-Policy&#34;</span><span class="p">:</span> <span class="s2">&#34;default-src &#39;self&#39; &#39;unsafe-inline&#39;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;X-Frame-Options&#34;</span><span class="p">:</span> <span class="s2">&#34;SAMEORIGIN&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;X-Content-Type-Options&#34;</span><span class="p">:</span> <span class="s2">&#34;nosniff&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;X-Content-Type-Options&#34;</span><span class="p">:</span> <span class="s2">&#34;nosniff&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">validate_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;验证请求安全性&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 检查Content-Type</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">body</span> <span class="ow">and</span> <span class="s1">&#39;Content-Type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&#34;缺少Content-Type头&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 检查CSRF保护</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;application/json&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s1">&#39;X-Requested-With&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">headers</span> <span class="ow">and</span> <span class="s1">&#39;X-CSRF-Token&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&#34;可能存在CSRF风险&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 检查认证</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;Authorization&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">headers</span> <span class="ow">and</span> <span class="s1">&#39;Cookie&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&#34;缺少认证信息&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;is_secure&#34;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">issues</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;issues&#34;</span><span class="p">:</span> <span class="n">issues</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># CORS处理</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CORSHandler</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;CORS跨域资源共享处理&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allowed_origins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allowed_methods</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allowed_headers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_origins</span> <span class="o">=</span> <span class="n">allowed_origins</span> <span class="ow">or</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_methods</span> <span class="o">=</span> <span class="n">allowed_methods</span> <span class="ow">or</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_headers</span> <span class="o">=</span> <span class="n">allowed_headers</span> <span class="ow">or</span> <span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;Authorization&#39;</span><span class="p">,</span> <span class="s1">&#39;X-Requested-With&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">handle_preflight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;处理预检请求&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">response_headers</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 检查来源</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_origin_allowed</span><span class="p">(</span><span class="n">origin</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">response_headers</span><span class="p">[</span><span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">origin</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 检查方法</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_methods</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">response_headers</span><span class="p">[</span><span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allowed_methods</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 检查头部</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">headers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">requested_headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">headers</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">            <span class="n">allowed</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">requested_headers</span> <span class="k">if</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_headers</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">allowed</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">response_headers</span><span class="p">[</span><span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">allowed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">response_headers</span><span class="p">[</span><span class="s1">&#39;Access-Control-Max-Age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;86400&#39;</span>  <span class="c1"># 24小时</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response_headers</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">handle_actual_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;处理实际请求&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">response_headers</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_origin_allowed</span><span class="p">(</span><span class="n">origin</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">response_headers</span><span class="p">[</span><span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">origin</span>
</span></span><span class="line"><span class="cl">            <span class="n">response_headers</span><span class="p">[</span><span class="s1">&#39;Access-Control-Allow-Credentials&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response_headers</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">is_origin_allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;检查来源是否被允许&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_origins</span> <span class="ow">or</span> <span class="n">origin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_origins</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 示例使用</span>
</span></span><span class="line"><span class="cl"><span class="n">security</span> <span class="o">=</span> <span class="n">HTTPSecurity</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;高安全级别头部:&#34;</span><span class="p">,</span> <span class="n">security</span><span class="o">.</span><span class="n">get_security_headers</span><span class="p">(</span><span class="s2">&#34;high&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># CORS示例</span>
</span></span><span class="line"><span class="cl"><span class="n">cors</span> <span class="o">=</span> <span class="n">CORSHandler</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">allowed_origins</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;https://app.example.com&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">allowed_methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">allowed_headers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;Authorization&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">preflight_headers</span> <span class="o">=</span> <span class="n">cors</span><span class="o">.</span><span class="n">handle_preflight</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;Content-Type, Authorization&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;预检响应头:&#34;</span><span class="p">,</span> <span class="n">preflight_headers</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="http2-和-http3-新特性">HTTP/2 和 HTTP/3 新特性<a hidden class="anchor" aria-hidden="true" href="#http2-和-http3-新特性">#</a></h2>
<h3 id="http2-特性">HTTP/2 特性<a hidden class="anchor" aria-hidden="true" href="#http2-特性">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HTTP2Features</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;HTTP/2 特性演示&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">streams</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">next_stream_id</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">create_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;创建HTTP/2流&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">stream_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_stream_id</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">next_stream_id</span> <span class="o">+=</span> <span class="mi">2</span>  <span class="c1"># 客户端流ID为奇数</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">stream</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="n">stream_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;method&#34;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;path&#34;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;headers&#34;</span><span class="p">:</span> <span class="n">headers</span> <span class="ow">or</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;state&#34;</span><span class="p">:</span> <span class="s2">&#34;open&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;priority&#34;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>  <span class="c1"># 默认优先级</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;dependency&#34;</span><span class="p">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">stream_id</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">set_priority</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">,</span> <span class="n">priority</span><span class="p">,</span> <span class="n">dependency</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;设置流优先级&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">stream_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s2">&#34;priority&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">priority</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s2">&#34;dependency&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dependency</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">server_push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_stream_id</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;服务器推送&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">push_stream_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_stream_id</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">next_stream_id</span> <span class="o">+=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">push_stream</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="n">push_stream_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;method&#34;</span><span class="p">:</span> <span class="s2">&#34;GET&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;path&#34;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;headers&#34;</span><span class="p">:</span> <span class="n">headers</span> <span class="ow">or</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;state&#34;</span><span class="p">:</span> <span class="s2">&#34;reserved_local&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;parent&#34;</span><span class="p">:</span> <span class="n">parent_stream_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;pushed&#34;</span><span class="p">:</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">[</span><span class="n">push_stream_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">push_stream</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">push_stream_id</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">compress_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;HPACK头部压缩模拟&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 简化的头部压缩示例</span>
</span></span><span class="line"><span class="cl">        <span class="n">compressed_size</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="n">static_table</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;:method&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;GET&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;POST&#34;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;:path&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;/&#34;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;:scheme&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;https&#34;</span><span class="p">:</span> <span class="mi">7</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;content-type&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;application/json&#34;</span><span class="p">:</span> <span class="mi">31</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">static_table</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">static_table</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">                <span class="n">compressed_size</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># 索引引用</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">compressed_size</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># 字面量</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">original_size</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="n">compression_ratio</span> <span class="o">=</span> <span class="n">compressed_size</span> <span class="o">/</span> <span class="n">original_size</span> <span class="k">if</span> <span class="n">original_size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;original_size&#34;</span><span class="p">:</span> <span class="n">original_size</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;compressed_size&#34;</span><span class="p">:</span> <span class="n">compressed_size</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;compression_ratio&#34;</span><span class="p">:</span> <span class="n">compression_ratio</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># HTTP/3 特性</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HTTP3Features</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;HTTP/3 特性演示&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">connections</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">connection_id</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">create_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;创建QUIC连接&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">connection_id</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">connection</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;server_name&#34;</span><span class="p">:</span> <span class="n">server_name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;state&#34;</span><span class="p">:</span> <span class="s2">&#34;handshaking&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;streams&#34;</span><span class="p">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;rtt&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;congestion_window&#34;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;migration_capable&#34;</span><span class="p">:</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">connection_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">connection</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_id</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">zero_rtt_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">early_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;0-RTT请求&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">connection_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">connection_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 模拟0-RTT请求</span>
</span></span><span class="line"><span class="cl">        <span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;method&#34;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;path&#34;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;early_data&#34;</span><span class="p">:</span> <span class="n">early_data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;rtt&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># 0-RTT</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;timestamp&#34;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">connection_migration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">,</span> <span class="n">new_address</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;连接迁移&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">connection_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">connection_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="s2">&#34;migration_capable&#34;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="n">connection</span><span class="p">[</span><span class="s2">&#34;address&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_address</span>
</span></span><span class="line"><span class="cl">            <span class="n">connection</span><span class="p">[</span><span class="s2">&#34;migrated&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_performance_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;性能对比&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;HTTP/1.1&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;连接建立&#34;</span><span class="p">:</span> <span class="s2">&#34;3-RTT (TCP + TLS)&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;多路复用&#34;</span><span class="p">:</span> <span class="s2">&#34;无&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;头部压缩&#34;</span><span class="p">:</span> <span class="s2">&#34;无&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;服务器推送&#34;</span><span class="p">:</span> <span class="s2">&#34;无&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;HTTP/2&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;连接建立&#34;</span><span class="p">:</span> <span class="s2">&#34;3-RTT (TCP + TLS)&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;多路复用&#34;</span><span class="p">:</span> <span class="s2">&#34;有 (单连接)&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;头部压缩&#34;</span><span class="p">:</span> <span class="s2">&#34;HPACK&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;服务器推送&#34;</span><span class="p">:</span> <span class="s2">&#34;有&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;HTTP/3&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;连接建立&#34;</span><span class="p">:</span> <span class="s2">&#34;1-RTT (QUIC)&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;多路复用&#34;</span><span class="p">:</span> <span class="s2">&#34;有 (无队头阻塞)&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;头部压缩&#34;</span><span class="p">:</span> <span class="s2">&#34;QPACK&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;服务器推送&#34;</span><span class="p">:</span> <span class="s2">&#34;有&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;连接迁移&#34;</span><span class="p">:</span> <span class="s2">&#34;有&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;0-RTT&#34;</span><span class="p">:</span> <span class="s2">&#34;有&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 示例使用</span>
</span></span><span class="line"><span class="cl"><span class="n">http2</span> <span class="o">=</span> <span class="n">HTTP2Features</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建多个流</span>
</span></span><span class="line"><span class="cl"><span class="n">stream1</span> <span class="o">=</span> <span class="n">http2</span><span class="o">.</span><span class="n">create_stream</span><span class="p">(</span><span class="s2">&#34;GET&#34;</span><span class="p">,</span> <span class="s2">&#34;/api/users&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">stream2</span> <span class="o">=</span> <span class="n">http2</span><span class="o">.</span><span class="n">create_stream</span><span class="p">(</span><span class="s2">&#34;GET&#34;</span><span class="p">,</span> <span class="s2">&#34;/api/posts&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">stream3</span> <span class="o">=</span> <span class="n">http2</span><span class="o">.</span><span class="n">create_stream</span><span class="p">(</span><span class="s2">&#34;GET&#34;</span><span class="p">,</span> <span class="s2">&#34;/static/app.js&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置优先级</span>
</span></span><span class="line"><span class="cl"><span class="n">http2</span><span class="o">.</span><span class="n">set_priority</span><span class="p">(</span><span class="n">stream3</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>  <span class="c1"># 静态资源优先级较低</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 服务器推送</span>
</span></span><span class="line"><span class="cl"><span class="n">push_stream</span> <span class="o">=</span> <span class="n">http2</span><span class="o">.</span><span class="n">server_push</span><span class="p">(</span><span class="n">stream1</span><span class="p">,</span> <span class="s2">&#34;/static/style.css&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 头部压缩</span>
</span></span><span class="line"><span class="cl"><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;:method&#34;</span><span class="p">:</span> <span class="s2">&#34;GET&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;:path&#34;</span><span class="p">:</span> <span class="s2">&#34;/api/users&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;:scheme&#34;</span><span class="p">:</span> <span class="s2">&#34;https&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;content-type&#34;</span><span class="p">:</span> <span class="s2">&#34;application/json&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">compression_result</span> <span class="o">=</span> <span class="n">http2</span><span class="o">.</span><span class="n">compress_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;头部压缩结果:&#34;</span><span class="p">,</span> <span class="n">compression_result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># HTTP/3示例</span>
</span></span><span class="line"><span class="cl"><span class="n">http3</span> <span class="o">=</span> <span class="n">HTTP3Features</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">conn_id</span> <span class="o">=</span> <span class="n">http3</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="s2">&#34;api.example.com&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 0-RTT请求</span>
</span></span><span class="line"><span class="cl"><span class="n">zero_rtt_req</span> <span class="o">=</span> <span class="n">http3</span><span class="o">.</span><span class="n">zero_rtt_request</span><span class="p">(</span><span class="n">conn_id</span><span class="p">,</span> <span class="s2">&#34;GET&#34;</span><span class="p">,</span> <span class="s2">&#34;/api/users&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;0-RTT请求:&#34;</span><span class="p">,</span> <span class="n">zero_rtt_req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 性能对比</span>
</span></span><span class="line"><span class="cl"><span class="n">comparison</span> <span class="o">=</span> <span class="n">http3</span><span class="o">.</span><span class="n">get_performance_comparison</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">version</span><span class="p">,</span> <span class="n">features</span> <span class="ow">in</span> <span class="n">comparison</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">feature</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">features</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  </span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="实际应用和最佳实践">实际应用和最佳实践<a hidden class="anchor" aria-hidden="true" href="#实际应用和最佳实践">#</a></h2>
<h3 id="web-api设计最佳实践">Web API设计最佳实践<a hidden class="anchor" aria-hidden="true" href="#web-api设计最佳实践">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WebAPIBestPractices</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Web API设计最佳实践&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">api_guidelines</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;URL设计&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;使用名词而非动词&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;使用复数形式&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;保持URL简洁&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;使用连字符分隔单词&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;HTTP方法使用&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;GET: 获取资源&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;POST: 创建资源&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;PUT: 完整更新资源&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;PATCH: 部分更新资源&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;DELETE: 删除资源&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;状态码使用&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;200: 成功&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;201: 创建成功&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;204: 无内容&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;400: 请求错误&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;401: 未授权&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;403: 禁止访问&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;404: 资源未找到&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;500: 服务器错误&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;响应格式&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;使用JSON格式&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;保持响应结构一致&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;包含适当的元数据&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;提供错误详情&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">design_api_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;设计API响应格式&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span><span class="p">[</span><span class="s2">&#34;success&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span><span class="p">[</span><span class="s2">&#34;error&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;code&#34;</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;code&#34;</span><span class="p">,</span> <span class="s2">&#34;UNKNOWN_ERROR&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;message&#34;</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;message&#34;</span><span class="p">,</span> <span class="s2">&#34;An error occurred&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;details&#34;</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;details&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span><span class="p">[</span><span class="s2">&#34;success&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span><span class="p">[</span><span class="s2">&#34;data&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span><span class="p">[</span><span class="s2">&#34;meta&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">response</span><span class="p">[</span><span class="s2">&#34;timestamp&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">paginate_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">per_page</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;分页响应&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="n">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">per_page</span>
</span></span><span class="line"><span class="cl">        <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">per_page</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">paginated_items</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">total</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">total_pages</span> <span class="o">=</span> <span class="p">(</span><span class="n">total</span> <span class="o">+</span> <span class="n">per_page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">per_page</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">design_api_response</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span><span class="o">=</span><span class="n">paginated_items</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">meta</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;pagination&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;page&#34;</span><span class="p">:</span> <span class="n">page</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;per_page&#34;</span><span class="p">:</span> <span class="n">per_page</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;total&#34;</span><span class="p">:</span> <span class="n">total</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;total_pages&#34;</span><span class="p">:</span> <span class="n">total_pages</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;has_next&#34;</span><span class="p">:</span> <span class="n">page</span> <span class="o">&lt;</span> <span class="n">total_pages</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;has_prev&#34;</span><span class="p">:</span> <span class="n">page</span> <span class="o">&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">validate_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_data</span><span class="p">,</span> <span class="n">required_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;请求验证&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">required_fields</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">required_fields</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">request_data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;缺少必需字段: </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">elif</span> <span class="ow">not</span> <span class="n">request_data</span><span class="p">[</span><span class="n">field</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;字段不能为空: </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;is_valid&#34;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;errors&#34;</span><span class="p">:</span> <span class="n">errors</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 性能优化建议</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HTTPPerformanceOptimization</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;HTTP性能优化&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">optimization_techniques</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;缓存策略&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;设置适当的Cache-Control头&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;使用ETag进行条件请求&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;实施CDN缓存&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;使用浏览器缓存&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;压缩技术&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;启用Gzip/Brotli压缩&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;压缩静态资源&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;优化图片格式&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;使用WebP格式&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;连接优化&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;使用HTTP/2或HTTP/3&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;启用Keep-Alive&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;减少DNS查询&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;使用连接池&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;请求优化&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;减少HTTP请求数量&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;合并CSS和JavaScript文件&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;使用雪碧图&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;延迟加载非关键资源&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">analyze_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response_time</span><span class="p">,</span> <span class="n">response_size</span><span class="p">,</span> <span class="n">cache_hit_ratio</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;性能分析&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">analysis</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;response_time&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;value&#34;</span><span class="p">:</span> <span class="n">response_time</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;good&#34;</span> <span class="k">if</span> <span class="n">response_time</span> <span class="o">&lt;</span> <span class="mi">200</span> <span class="k">else</span> <span class="s2">&#34;needs_improvement&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;response_size&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;value&#34;</span><span class="p">:</span> <span class="n">response_size</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;good&#34;</span> <span class="k">if</span> <span class="n">response_size</span> <span class="o">&lt;</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="k">else</span> <span class="s2">&#34;large&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;cache_efficiency&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;hit_ratio&#34;</span><span class="p">:</span> <span class="n">cache_hit_ratio</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;good&#34;</span> <span class="k">if</span> <span class="n">cache_hit_ratio</span> <span class="o">&gt;</span> <span class="mf">0.8</span> <span class="k">else</span> <span class="s2">&#34;needs_improvement&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">response_time</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&#34;考虑使用CDN或优化服务器响应时间&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">response_size</span> <span class="o">&gt;</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&#34;启用压缩或优化响应内容&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">cache_hit_ratio</span> <span class="o">&lt;</span> <span class="mf">0.8</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&#34;优化缓存策略&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">analysis</span><span class="p">[</span><span class="s2">&#34;recommendations&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recommendations</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">analysis</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 示例使用</span>
</span></span><span class="line"><span class="cl"><span class="n">api</span> <span class="o">=</span> <span class="n">WebAPIBestPractices</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设计成功响应</span>
</span></span><span class="line"><span class="cl"><span class="n">success_response</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">design_api_response</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;张三&#34;</span><span class="p">,</span> <span class="s2">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;zhangsan@example.com&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;成功响应:&#34;</span><span class="p">,</span> <span class="n">success_response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设计错误响应</span>
</span></span><span class="line"><span class="cl"><span class="n">error_response</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">design_api_response</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">error</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;code&#34;</span><span class="p">:</span> <span class="s2">&#34;VALIDATION_ERROR&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;请求数据验证失败&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;details&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;邮箱格式不正确&#34;</span><span class="p">,</span> <span class="s2">&#34;密码长度不足&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;错误响应:&#34;</span><span class="p">,</span> <span class="n">error_response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 分页响应</span>
</span></span><span class="line"><span class="cl"><span class="n">users</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;用户</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">101</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">paginated</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">paginate_response</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">per_page</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;分页响应:&#34;</span><span class="p">,</span> <span class="n">paginated</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 性能分析</span>
</span></span><span class="line"><span class="cl"><span class="n">perf</span> <span class="o">=</span> <span class="n">HTTPPerformanceOptimization</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">analysis</span> <span class="o">=</span> <span class="n">perf</span><span class="o">.</span><span class="n">analyze_performance</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">response_time</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>  <span class="c1"># ms</span>
</span></span><span class="line"><span class="cl">    <span class="n">response_size</span><span class="o">=</span><span class="mi">512</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>  <span class="c1"># bytes</span>
</span></span><span class="line"><span class="cl">    <span class="n">cache_hit_ratio</span><span class="o">=</span><span class="mf">0.75</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;性能分析:&#34;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="学习建议和总结">学习建议和总结<a hidden class="anchor" aria-hidden="true" href="#学习建议和总结">#</a></h2>
<h3 id="http学习路径">HTTP学习路径<a hidden class="anchor" aria-hidden="true" href="#http学习路径">#</a></h3>
<ol>
<li><strong>基础概念</strong>：理解HTTP的工作原理和特点</li>
<li><strong>协议细节</strong>：掌握请求响应格式、状态码、头字段</li>
<li><strong>缓存机制</strong>：学习HTTP缓存策略和实现</li>
<li><strong>安全机制</strong>：了解HTTPS、CORS、安全头等</li>
<li><strong>性能优化</strong>：掌握HTTP性能优化技巧</li>
<li><strong>新版本特性</strong>：学习HTTP/2和HTTP/3的新特性</li>
</ol>
<h3 id="关键要点总结">关键要点总结<a hidden class="anchor" aria-hidden="true" href="#关键要点总结">#</a></h3>
<table>
  <thead>
      <tr>
          <th>方面</th>
          <th>要点</th>
          <th>实践建议</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>请求方法</strong></td>
          <td>正确使用GET、POST、PUT、DELETE等</td>
          <td>遵循RESTful设计原则</td>
      </tr>
      <tr>
          <td><strong>状态码</strong></td>
          <td>返回合适的HTTP状态码</td>
          <td>提供清晰的错误信息</td>
      </tr>
      <tr>
          <td><strong>缓存</strong></td>
          <td>合理设置缓存策略</td>
          <td>平衡性能和数据新鲜度</td>
      </tr>
      <tr>
          <td><strong>安全</strong></td>
          <td>实施适当的安全措施</td>
          <td>使用HTTPS和安全头</td>
      </tr>
      <tr>
          <td><strong>性能</strong></td>
          <td>优化请求和响应</td>
          <td>使用压缩和CDN</td>
      </tr>
  </tbody>
</table>
<h3 id="实际应用建议">实际应用建议<a hidden class="anchor" aria-hidden="true" href="#实际应用建议">#</a></h3>
<ul>
<li><strong>API设计</strong>：遵循RESTful原则，保持接口一致性</li>
<li><strong>错误处理</strong>：提供详细的错误信息和处理建议</li>
<li><strong>文档化</strong>：维护完整的API文档</li>
<li><strong>监控</strong>：实施性能监控和日志记录</li>
<li><strong>版本控制</strong>：合理管理API版本</li>
</ul>
<p>HTTP协议是Web开发的基础，深入理解其工作原理和最佳实践对于构建高质量的Web应用至关重要。随着HTTP/2和HTTP/3的普及，掌握新特性将有助于进一步提升应用性能。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://tyhzxh.github.io/tags/http/">HTTP</a></li>
      <li><a href="https://tyhzxh.github.io/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/">网络协议</a></li>
      <li><a href="https://tyhzxh.github.io/tags/web%E5%BC%80%E5%8F%91/">Web开发</a></li>
      <li><a href="https://tyhzxh.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></li>
      <li><a href="https://tyhzxh.github.io/tags/%E5%89%8D%E7%AB%AF/">前端</a></li>
      <li><a href="https://tyhzxh.github.io/tags/%E5%90%8E%E7%AB%AF/">后端</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://tyhzxh.github.io/posts/tcp-protocol-guide/">
    <span class="title">« Prev</span>
    <br>
    <span>TCP协议深度解析：可靠传输的核心机制</span>
  </a>
  <a class="next" href="https://tyhzxh.github.io/posts/sorting-algorithms-implementation/">
    <span class="title">Next »</span>
    <br>
    <span>经典排序算法实现与分析</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://tyhzxh.github.io/">tyhzxh的个人博客</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
