<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>CSAPP第二章：信息的表示与处理 | tyhzxh的个人博客</title>
<meta name="keywords" content="CSAPP, 计算机系统, 数据表示, 二进制, 补码, 浮点数">
<meta name="description" content="深入理解计算机系统第二章学习笔记，涵盖整数表示、补码、大小端、浮点数等核心概念，包含实际代码示例">
<meta name="author" content="tyhzxh">
<link rel="canonical" href="http://localhost:1313/posts/csapp-chapter2-data-representation/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8ee78296343cf29844826f6d943ca1b6638fc5059dcdf673ace996a7617f1b69.css" integrity="sha256-jueCljQ88phEgm9tlDyhtmOPxQWdzfZzrOmWp2F/G2k=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/csapp-chapter2-data-representation/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<style>
/* 归档页面摘要样式 */
.archive-summary {
  margin-bottom: 2rem;
  padding: 1rem;
  background: var(--theme);
  border-radius: 8px;
  border: 1px solid var(--border);
  text-align: center;
  color: var(--secondary);
  font-size: 0.9rem;
}

/* 分页导航样式 */
.pagination {
  display: flex !important;
  justify-content: center;
  align-items: center;
  gap: 1rem;
  margin: 3rem 0;
  padding: 2rem 0;
  border-top: 1px solid var(--border);
}

/* 覆盖主题默认样式 */
.pagination a.pagination-prev,
.pagination a.pagination-next {
  padding: 0.75rem 1.5rem !important;
  background: var(--entry) !important;
  border: 1px solid var(--border) !important;
  border-radius: 6px !important;
  text-decoration: none !important;
  color: var(--primary) !important;
  font-weight: 500 !important;
  transition: all 0.3s ease !important;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05) !important;
  font-size: 14px !important;
  line-height: normal !important;
}

.pagination a.pagination-prev:hover,
.pagination a.pagination-next:hover {
  background: var(--hljs-bg) !important;
  color: var(--primary) !important;
  transform: translateY(-2px) !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
  border-color: var(--tertiary) !important;
}

.pagination-numbers {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

.pagination a.pagination-number,
.pagination-current {
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  width: 2.5rem !important;
  height: 2.5rem !important;
  border-radius: 50% !important;
  text-decoration: none !important;
  font-weight: 500 !important;
  transition: all 0.3s ease !important;
  font-size: 14px !important;
  line-height: normal !important;
  padding: 0 !important;
}

.pagination a.pagination-number {
  background: var(--entry) !important;
  border: 1px solid var(--border) !important;
  color: var(--primary) !important;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05) !important;
}

.pagination a.pagination-number:hover {
  background: var(--hljs-bg) !important;
  color: var(--primary) !important;
  transform: scale(1.1) !important;
  border-color: var(--tertiary) !important;
}

.pagination-current {
  background: var(--tertiary) !important;
  color: var(--primary) !important;
  border: 1px solid var(--tertiary) !important;
  font-weight: 600 !important;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
}

/* 响应式设计 */
@media (max-width: 768px) {
  .pagination {
    flex-direction: column;
    gap: 1rem;
  }
  
  .pagination-prev,
  .pagination-next {
    width: 100%;
    text-align: center;
  }
  
  .pagination-numbers {
    order: -1;
  }
  
  .archive-summary {
    font-size: 0.8rem;
    padding: 0.75rem;
  }
}

/* 暗色主题适配 */
[data-theme="dark"] .archive-summary {
  background: var(--entry);
}

[data-theme="dark"] .pagination-prev,
[data-theme="dark"] .pagination-next,
[data-theme="dark"] .pagination-number {
  background: var(--entry);
  border-color: var(--border);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

[data-theme="dark"] .pagination-prev:hover,
[data-theme="dark"] .pagination-next:hover,
[data-theme="dark"] .pagination-number:hover {
  background: var(--hljs-bg);
  border-color: var(--tertiary);
}

[data-theme="dark"] .pagination-current {
  background: var(--tertiary);
  border-color: var(--tertiary);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}
</style>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="tyhzxh的个人博客 (Alt + H)">tyhzxh的个人博客</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="首页">
                    <span>首页</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/posts/" title="文章">
                    <span>文章</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="搜索 (Alt &#43; /)" accesskey=/>
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="关于">
                    <span>关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      CSAPP第二章：信息的表示与处理
    </h1>
    <div class="post-description">
      深入理解计算机系统第二章学习笔记，涵盖整数表示、补码、大小端、浮点数等核心概念，包含实际代码示例
    </div>
    <div class="post-meta"><span title='2024-04-07 23:31:21 +0800 CST'>April 7, 2024</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;tyhzxh

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%89%8d%e8%a8%80" aria-label="前言">前言</a></li>
                <li>
                    <a href="#%e4%b8%80%e6%95%b4%e6%95%b0%e8%a1%a8%e7%a4%ba" aria-label="一、整数表示">一、整数表示</a><ul>
                        
                <li>
                    <a href="#%e5%86%85%e5%ad%98%e6%a8%a1%e5%9e%8b%e5%9f%ba%e7%a1%80" aria-label="内存模型基础">内存模型基础</a></li>
                <li>
                    <a href="#%e8%bf%9b%e5%88%b6%e8%bd%ac%e6%8d%a2%e5%9f%ba%e7%a1%80" aria-label="进制转换基础">进制转换基础</a></li>
                <li>
                    <a href="#%e6%9c%89%e7%ac%a6%e5%8f%b7%e6%95%b0%e8%a1%a5%e7%a0%81%e8%a1%a8%e7%a4%ba" aria-label="有符号数（补码表示）">有符号数（补码表示）</a><ul>
                        
                <li>
                    <a href="#%e8%a1%a5%e7%a0%81%e7%9a%84%e7%b2%be%e5%a6%99%e8%ae%be%e8%ae%a1" aria-label="补码的精妙设计">补码的精妙设计</a></li>
                <li>
                    <a href="#%e8%a1%a5%e7%a0%81%e7%9a%84%e4%bc%98%e5%8a%bf" aria-label="补码的优势">补码的优势</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%97%a0%e7%ac%a6%e5%8f%b7%e6%95%b0" aria-label="无符号数">无符号数</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%ba%8c%e5%ae%9e%e9%99%85%e7%bc%96%e7%a8%8b%e7%bb%83%e4%b9%a0" aria-label="二、实际编程练习">二、实际编程练习</a><ul>
                        
                <li>
                    <a href="#1-%e5%a4%a7%e5%b0%8f%e7%ab%af%e6%a3%80%e6%b5%8b%e7%a8%8b%e5%ba%8f" aria-label="1. 大小端检测程序">1. 大小端检测程序</a></li>
                <li>
                    <a href="#2-%e5%ad%97%e8%8a%82%e5%ba%8f%e5%88%97%e6%98%be%e7%a4%ba%e7%a8%8b%e5%ba%8f" aria-label="2. 字节序列显示程序">2. 字节序列显示程序</a></li>
                <li>
                    <a href="#3-%e4%bd%8d%e8%bf%90%e7%ae%97%e7%bb%83%e4%b9%a0" aria-label="3. 位运算练习">3. 位运算练习</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%b8%89%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b%e6%80%bb%e7%bb%93" aria-label="三、数据类型总结">三、数据类型总结</a><ul>
                        
                <li>
                    <a href="#%e6%95%b4%e6%95%b0%e7%b1%bb%e5%9e%8b" aria-label="整数类型">整数类型</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%9b%9b%e6%b5%ae%e7%82%b9%e6%95%b0ieee-754%e6%a0%87%e5%87%86" aria-label="四、浮点数（IEEE 754标准）">四、浮点数（IEEE 754标准）</a><ul>
                        
                <li>
                    <a href="#%e6%b5%ae%e7%82%b9%e6%95%b0%e7%bb%93%e6%9e%84" aria-label="浮点数结构">浮点数结构</a></li>
                <li>
                    <a href="#%e6%b5%ae%e7%82%b9%e6%95%b0%e5%88%86%e7%b1%bb" aria-label="浮点数分类">浮点数分类</a></li>
                <li>
                    <a href="#%e6%b5%ae%e7%82%b9%e6%95%b0%e7%9a%84%e7%b2%be%e5%a6%99%e4%b9%8b%e5%a4%84" aria-label="浮点数的精妙之处">浮点数的精妙之处</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%ba%94%e8%bf%90%e7%ae%97%e4%b8%8e%e6%ba%a2%e5%87%ba" aria-label="五、运算与溢出">五、运算与溢出</a><ul>
                        
                <li>
                    <a href="#%e6%95%b4%e6%95%b0%e8%bf%90%e7%ae%97%e7%89%b9%e7%82%b9" aria-label="整数运算特点">整数运算特点</a></li>
                <li>
                    <a href="#%e5%ae%9e%e9%99%85%e5%ba%94%e7%94%a8%e4%b8%ad%e7%9a%84%e9%99%b7%e9%98%b1" aria-label="实际应用中的陷阱">实际应用中的陷阱</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%85%ad%e5%ad%a6%e4%b9%a0%e5%bf%83%e5%be%97" aria-label="六、学习心得">六、学习心得</a><ul>
                        
                <li>
                    <a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e5%ad%a6%e4%b9%a0%e5%ba%95%e5%b1%82%e8%a1%a8%e7%a4%ba" aria-label="为什么要学习底层表示？">为什么要学习底层表示？</a></li>
                <li>
                    <a href="#%e5%ad%a6%e4%b9%a0%e5%bb%ba%e8%ae%ae" aria-label="学习建议">学习建议</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%80%bb%e7%bb%93" aria-label="总结">总结</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><blockquote>
<p>著名的大黑书 CSAPP《深入理解计算机系统》第二章学习笔记。从第二章（信息的表示与处理）开始，这是计算机底层数据表示的核心内容。</p></blockquote>
<h2 id="前言">前言<a hidden class="anchor" aria-hidden="true" href="#前言">#</a></h2>
<p>从这一章开始，CSAPP将我们引入了计算机最底层的数据表示领域——<strong>梦开始的地方</strong>！</p>
<blockquote>
<p><strong>核心观点</strong>：计算机中的二进制序列本身是没有实际意义的，重要的是看你怎么去<strong>解释</strong>它。</p></blockquote>
<p>这句话贯穿了整个计算机系统的设计哲学。</p>
<h2 id="一整数表示">一、整数表示<a hidden class="anchor" aria-hidden="true" href="#一整数表示">#</a></h2>
<h3 id="内存模型基础">内存模型基础<a hidden class="anchor" aria-hidden="true" href="#内存模型基础">#</a></h3>
<p>程序员编程时面对的是一个<strong>内存空间</strong>（一种抽象），这个内存空间本质上是：</p>
<ul>
<li>一个很长的<strong>字节数组</strong>（字节是内存的最小单位）</li>
<li>每个字节由8个二进制位组成</li>
<li>本质上就是一堆二进制序列</li>
</ul>
<h3 id="进制转换基础">进制转换基础<a hidden class="anchor" aria-hidden="true" href="#进制转换基础">#</a></h3>
<p>每个字节里的8位二进制数习惯用16进制表示：</p>
<pre tabindex="0"><code>二进制: 11111111
十六进制: FF
</code></pre><p><strong>记忆技巧</strong>：</p>
<ul>
<li>16进制的两位分别由二进制的4位组成</li>
<li>每一位的权重：8、4、2、1（数字电路基础）</li>
</ul>
<h3 id="有符号数补码表示">有符号数（补码表示）<a hidden class="anchor" aria-hidden="true" href="#有符号数补码表示">#</a></h3>
<p>以<code>int</code>类型为例：</p>
<ul>
<li><strong>大小</strong>：4个字节，共32位</li>
<li><strong>符号位</strong>：第一位，0表示正数，1表示负数</li>
<li><strong>存储方式</strong>：补码</li>
</ul>
<h4 id="补码的精妙设计">补码的精妙设计<a hidden class="anchor" aria-hidden="true" href="#补码的精妙设计">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// 正数：直接表示
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>    <span class="c1">// 00000000 00000000 00000000 00000101
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 负数：补码表示
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="p">;</span>   <span class="c1">// 11111111 11111111 11111111 11111011
</span></span></span></code></pre></div><p><strong>补码计算规则</strong>：</p>
<ol>
<li>正数的补码就是其二进制表示</li>
<li>负数的补码 = 按位取反 + 1</li>
<li>数的相反数 = 按位取反 + 1</li>
</ol>
<h4 id="补码的优势">补码的优势<a hidden class="anchor" aria-hidden="true" href="#补码的优势">#</a></h4>
<ol>
<li><strong>统一运算</strong>：加法和减法可以用同一套电路实现</li>
<li><strong>唯一零值</strong>：只有一个零的表示</li>
<li><strong>范围对称</strong>：能表示的负数比正数多一个</li>
</ol>
<h3 id="无符号数">无符号数<a hidden class="anchor" aria-hidden="true" href="#无符号数">#</a></h3>
<p>无符号数最简单：32位二进制代码直接对应真值，没有符号位的概念。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">4294967295U</span><span class="p">;</span>  <span class="c1">// 2^32 - 1
</span></span></span></code></pre></div><h2 id="二实际编程练习">二、实际编程练习<a hidden class="anchor" aria-hidden="true" href="#二实际编程练习">#</a></h2>
<h3 id="1-大小端检测程序">1. 大小端检测程序<a hidden class="anchor" aria-hidden="true" href="#1-大小端检测程序">#</a></h3>
<p><strong>背景</strong>：大小端之争是计算机历史上的经典问题</p>
<ul>
<li><strong>小端机器</strong>：低位字节存储在低地址（现在PC大多是小端）</li>
<li><strong>大端机器</strong>：高位字节存储在低地址</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">char</span> <span class="nf">get_first_bytes</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">a</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">islittle_endian</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nf">get_first_bytes</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">a</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;is little_endian</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;is big_endian</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">islittle_endian</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><strong>原理解析</strong>：</p>
<ul>
<li>整数1的二进制：<code>00000000 00000000 00000000 00000001</code></li>
<li>小端机器：第一个字节存储<code>01</code>（非零）</li>
<li>大端机器：第一个字节存储<code>00</code>（零）</li>
</ul>
<h3 id="2-字节序列显示程序">2. 字节序列显示程序<a hidden class="anchor" aria-hidden="true" href="#2-字节序列显示程序">#</a></h3>
<p>这个程序可以显示任意数据类型在内存中的字节表示：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">byte_pointer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">show_bytes</span><span class="p">(</span><span class="n">byte_pointer</span> <span class="n">start</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%.2x &#34;</span><span class="p">,</span> <span class="n">start</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">show_int</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">show_bytes</span><span class="p">((</span><span class="n">byte_pointer</span><span class="p">)</span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">show_float</span><span class="p">(</span><span class="kt">float</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">show_bytes</span><span class="p">((</span><span class="n">byte_pointer</span><span class="p">)</span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">show_pointer</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">show_bytes</span><span class="p">((</span><span class="n">byte_pointer</span><span class="p">)</span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">show_short</span><span class="p">(</span><span class="kt">short</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">show_bytes</span><span class="p">((</span><span class="n">byte_pointer</span><span class="p">)</span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">short</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">show_long</span><span class="p">(</span><span class="kt">long</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">show_bytes</span><span class="p">((</span><span class="n">byte_pointer</span><span class="p">)</span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">long</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">show_double</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">show_bytes</span><span class="p">((</span><span class="n">byte_pointer</span><span class="p">)</span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">test_show_bytes</span><span class="p">(</span><span class="kt">short</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">short</span> <span class="n">sval</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">long</span> <span class="n">lval</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">dval</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;short %d: &#34;</span><span class="p">,</span> <span class="n">sval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">show_short</span><span class="p">(</span><span class="n">sval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;long %ld: &#34;</span><span class="p">,</span> <span class="n">lval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">show_long</span><span class="p">(</span><span class="n">lval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;double %f: &#34;</span><span class="p">,</span> <span class="n">dval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">show_double</span><span class="p">(</span><span class="n">dval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">test_show_bytes</span><span class="p">(</span><span class="mi">12345</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="3-位运算练习">3. 位运算练习<a hidden class="anchor" aria-hidden="true" href="#3-位运算练习">#</a></h3>
<p>位运算是底层编程的基础：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 设置所有位为1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">f1</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">|</span> <span class="mh">0xffffffff</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 设置所有位为0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">f2</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x00000000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 设置最高字节为1，其他不变
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">f3</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">|</span> <span class="mh">0xff000000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 清除最低字节，其他不变
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">f4</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0xffffff00</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">show_hex</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;0x%x</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mh">0x12345678</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Original: &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">show_hex</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;f1 (set all 1): &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">show_hex</span><span class="p">(</span><span class="nf">f1</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;f2 (set all 0): &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">show_hex</span><span class="p">(</span><span class="nf">f2</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;f3 (set high byte): &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">show_hex</span><span class="p">(</span><span class="nf">f3</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;f4 (clear low byte): &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">show_hex</span><span class="p">(</span><span class="nf">f4</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="三数据类型总结">三、数据类型总结<a hidden class="anchor" aria-hidden="true" href="#三数据类型总结">#</a></h2>
<h3 id="整数类型">整数类型<a hidden class="anchor" aria-hidden="true" href="#整数类型">#</a></h3>
<table>
  <thead>
      <tr>
          <th>类型</th>
          <th>大小</th>
          <th>范围</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>char</code></td>
          <td>1字节</td>
          <td>-128 ~ 127</td>
      </tr>
      <tr>
          <td><code>unsigned char</code></td>
          <td>1字节</td>
          <td>0 ~ 255</td>
      </tr>
      <tr>
          <td><code>short</code></td>
          <td>2字节</td>
          <td>-32,768 ~ 32,767</td>
      </tr>
      <tr>
          <td><code>unsigned short</code></td>
          <td>2字节</td>
          <td>0 ~ 65,535</td>
      </tr>
      <tr>
          <td><code>int</code></td>
          <td>4字节</td>
          <td>-2^31 ~ 2^31-1</td>
      </tr>
      <tr>
          <td><code>unsigned int</code></td>
          <td>4字节</td>
          <td>0 ~ 2^32-1</td>
      </tr>
  </tbody>
</table>
<p><strong>命名规则</strong>：无符号类型 = <code>unsigned</code> + 有符号类型名</p>
<blockquote>
<p><strong>注意</strong>：<code>unsigned</code> 单独使用等价于 <code>unsigned int</code></p></blockquote>
<h2 id="四浮点数ieee-754标准">四、浮点数（IEEE 754标准）<a hidden class="anchor" aria-hidden="true" href="#四浮点数ieee-754标准">#</a></h2>
<p>浮点数的表示更加复杂，但设计同样精妙：</p>
<h3 id="浮点数结构">浮点数结构<a hidden class="anchor" aria-hidden="true" href="#浮点数结构">#</a></h3>
<pre tabindex="0"><code>符号位(S) | 阶码(Exp) | 尾数(Frac)
   1位   |   8位     |   23位    (单精度float)
   1位   |   11位    |   52位    (双精度double)
</code></pre><h3 id="浮点数分类">浮点数分类<a hidden class="anchor" aria-hidden="true" href="#浮点数分类">#</a></h3>
<ol>
<li><strong>规格化数</strong>：正常的浮点数</li>
<li><strong>非规格化数</strong>：接近零的很小数</li>
<li><strong>无穷大</strong>：溢出表示</li>
<li><strong>NaN</strong>：非数字（如0/0的结果）</li>
</ol>
<h3 id="浮点数的精妙之处">浮点数的精妙之处<a hidden class="anchor" aria-hidden="true" href="#浮点数的精妙之处">#</a></h3>
<blockquote>
<p>浮点数和补码一样精妙，设计得可以像整数一样进行大小比较排序！</p></blockquote>
<p>当你理解了IEEE 754的设计哲学时，就不会再觉得浮点数复杂了。</p>
<h2 id="五运算与溢出">五、运算与溢出<a hidden class="anchor" aria-hidden="true" href="#五运算与溢出">#</a></h2>
<h3 id="整数运算特点">整数运算特点<a hidden class="anchor" aria-hidden="true" href="#整数运算特点">#</a></h3>
<ol>
<li><strong>模运算</strong>：整数运算实际上是模2^w运算（w是位数）</li>
<li><strong>溢出处理</strong>：有符号数溢出可能产生意外结果</li>
<li><strong>类型转换</strong>：有符号和无符号之间的转换需要特别注意</li>
</ol>
<h3 id="实际应用中的陷阱">实际应用中的陷阱<a hidden class="anchor" aria-hidden="true" href="#实际应用中的陷阱">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// 危险的代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;a &gt; b</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>  <span class="c1">// 这行不会执行！
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;a &lt;= b</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span> <span class="c1">// 这行会执行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p><strong>原因</strong>：比较时<code>b</code>被转换为无符号数，-1变成了很大的正数。</p>
<h2 id="六学习心得">六、学习心得<a hidden class="anchor" aria-hidden="true" href="#六学习心得">#</a></h2>
<h3 id="为什么要学习底层表示">为什么要学习底层表示？<a hidden class="anchor" aria-hidden="true" href="#为什么要学习底层表示">#</a></h3>
<ol>
<li><strong>理解程序行为</strong>：很多&quot;奇怪&quot;的程序行为都能从底层找到原因</li>
<li><strong>性能优化</strong>：了解数据表示有助于写出更高效的代码</li>
<li><strong>调试能力</strong>：能够分析内存dump，理解程序崩溃原因</li>
<li><strong>系统编程</strong>：操作系统、编译器等系统软件开发的基础</li>
</ol>
<h3 id="学习建议">学习建议<a hidden class="anchor" aria-hidden="true" href="#学习建议">#</a></h3>
<ol>
<li><strong>动手实践</strong>：一定要亲自编写和运行代码</li>
<li><strong>可视化理解</strong>：画出内存布局图</li>
<li><strong>关联思考</strong>：将抽象概念与具体实现联系起来</li>
<li><strong>循序渐进</strong>：从简单例子开始，逐步深入</li>
</ol>
<h2 id="总结">总结<a hidden class="anchor" aria-hidden="true" href="#总结">#</a></h2>
<p>CSAPP第二章看似简单，实则包含了计算机系统最核心的设计思想：</p>
<ul>
<li><strong>补码设计</strong>：统一了正负数的运算</li>
<li><strong>IEEE 754</strong>：精妙的浮点数表示标准</li>
<li><strong>位运算</strong>：高效的底层操作方式</li>
</ul>
<blockquote>
<p>计算机的底层既简单又复杂：简单在于其实现是如此优美和巧妙，复杂在于需要处理各种边界情况和特殊场景。</p></blockquote>
<p>理解这些基础概念，是深入学习计算机系统的第一步。接下来的章节会在这个基础上，探讨更复杂的系统概念。</p>
<hr>
<p><em>下一篇将总结CSAPP的Data Lab实验，那里有更多有趣的位运算挑战！</em></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/csapp/">CSAPP</a></li>
      <li><a href="http://localhost:1313/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/">计算机系统</a></li>
      <li><a href="http://localhost:1313/tags/%E6%95%B0%E6%8D%AE%E8%A1%A8%E7%A4%BA/">数据表示</a></li>
      <li><a href="http://localhost:1313/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/">二进制</a></li>
      <li><a href="http://localhost:1313/tags/%E8%A1%A5%E7%A0%81/">补码</a></li>
      <li><a href="http://localhost:1313/tags/%E6%B5%AE%E7%82%B9%E6%95%B0/">浮点数</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/leveldb-source-code-guide/">
    <span class="title">« Prev</span>
    <br>
    <span>LevelDB源码阅读指南</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/computer-network-overview/">
    <span class="title">Next »</span>
    <br>
    <span>计算机网络概述：从OSI模型到TCP/IP协议栈</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">tyhzxh的个人博客</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
